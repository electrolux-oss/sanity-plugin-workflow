{"version":3,"file":"index.esm.js","sources":["../src/types/index.ts","../src/constants/index.ts","../src/components/UserAssignment.tsx","../src/hooks/useWorkflowMetadata.tsx","../src/components/WorkflowContext.tsx","../src/hooks/useUsers.ts","../src/actions/AssignWorkflow.tsx","../src/actions/BeginWorkflow.tsx","../src/actions/CompleteWorkflow.tsx","../src/helpers/arraysContainMatchingString.ts","../src/actions/UpdateWorkflow.tsx","../src/badges/AssigneesBadge.tsx","../src/badges/StateBadge.tsx","../src/components/WorkflowSignal.tsx","../src/components/DocumentCard/EditButton.tsx","../src/components/DocumentCard/Field.tsx","../src/components/UserAssignmentInput.tsx","../src/helpers/initialRank.ts","../src/schema/workflow/workflow.metadata.ts","../src/helpers/filterItemsAndSort.ts","../src/hooks/useWorkflowDocuments.tsx","../src/components/DocumentCard/AvatarGroup.tsx","../src/components/UserDisplay.tsx","../src/components/DocumentCard/CompleteButton.tsx","../src/components/DocumentCard/core/TimeAgo.tsx","../src/components/DocumentCard/core/DraftStatus.tsx","../src/components/DocumentCard/core/PublishedStatus.tsx","../src/components/DocumentCard/Validate.tsx","../src/components/DocumentCard/ValidationStatus.tsx","../src/components/DocumentCard/index.tsx","../src/components/DocumentList.tsx","../src/components/Filters.tsx","../src/components/StateTitle/Status.tsx","../src/components/StateTitle/index.tsx","../src/helpers/generateMultipleOrderRanks.ts","../src/components/FloatingCard.tsx","../src/components/Verify.tsx","../src/components/WorkflowTool.tsx","../src/tools/index.ts","../src/index.ts"],"sourcesContent":["import {CurrentUser, SanityDocumentLike} from 'sanity'\n\nexport type State = {\n  id: string\n  transitions: string[]\n  title: string\n  roles?: string[]\n  requireAssignment?: boolean\n  requireValidation?: boolean\n  // From document badges\n  color?: 'primary' | 'success' | 'warning' | 'danger'\n}\n\nexport type StateCheck<Id, States> = {\n  id: Id\n  // Transitions is an array of State ids\n  transitions?: States extends {id: infer Id2}[] ? Id2[] : never\n} & State\n\nexport type FilterOptions = {\n  locales: string[]\n}\n\nexport type WorkflowConfig = {\n  schemaTypes: string[]\n  states?: State[]\n  filters?: (user: CurrentUser | null) => FilterOptions | undefined\n}\n\nexport function defineStates<\n  Id extends string,\n  States extends StateCheck<Id, States>[]\n>(states: States): States {\n  return states\n}\n\nexport type User = {\n  createdAt: string\n  displayName: string\n  email: string\n  familyName: string\n  givenName: string\n  id: string\n  imageUrl: string\n  isCurrentUser: boolean\n  middleName: string\n  projectId: string\n  provider: string\n  sanityUserId: string\n  updatedAt: string\n}\n\nexport type DragData = {\n  documentId?: string\n  x?: number\n  y?: number\n  state?: string\n}\n\nexport type Metadata = SanityDocumentLike & {\n  _rev: string\n  assignees: string[]\n  documentId: string\n  state: string\n  orderRank: string\n  locale: string\n}\n\nexport type KeyedMetadata = {[key: string]: Metadata}\n\nexport type SanityDocumentWithMetadata = {\n  _metadata: Metadata\n  _id: string\n  _type: string\n  _rev: string\n  _updatedAt: string\n}\n","import {defineStates, WorkflowConfig} from '../types'\n\nexport const API_VERSION = `2023-01-01`\n\nexport const DEFAULT_CONFIG: Required<WorkflowConfig> = {\n  schemaTypes: [],\n  states: defineStates([\n    {\n      id: 'inReview',\n      title: 'In review',\n      color: 'primary',\n      roles: ['editor', 'administrator'],\n      transitions: ['changesRequested', 'approved'],\n    },\n    {\n      id: 'changesRequested',\n      title: 'Changes requested',\n      color: 'warning',\n      roles: ['editor', 'administrator'],\n      transitions: ['approved'],\n    },\n    {\n      id: 'approved',\n      title: 'Approved',\n      color: 'success',\n      roles: ['administrator'],\n      transitions: ['changesRequested'],\n      requireAssignment: true,\n    },\n  ]),\n  filters: () => undefined,\n}\n","import React from 'react'\nimport {useToast} from '@sanity/ui'\nimport {UserSelectMenu} from 'sanity-plugin-utils'\nimport {useClient} from 'sanity'\n\nimport {User} from '../types'\nimport {API_VERSION} from '../constants'\n\ntype UserAssignmentProps = {\n  userList: User[]\n  assignees: string[]\n  documentId: string\n}\n\nexport default function UserAssignment(props: UserAssignmentProps) {\n  const {assignees, userList, documentId} = props\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n\n  const addAssignee = React.useCallback(\n    (userId: string) => {\n      const user = userList.find((u) => u.id === userId)\n\n      if (!userId || !user) {\n        return toast.push({\n          status: 'error',\n          title: 'Could not find User',\n        })\n      }\n\n      return client\n        .patch(`workflow-metadata.${documentId}`)\n        .setIfMissing({assignees: []})\n        .insert(`after`, `assignees[-1]`, [userId])\n        .commit()\n        .then(() => {\n          return toast.push({\n            title: `Added ${user.displayName} to assignees`,\n            status: 'success',\n          })\n        })\n        .catch((err) => {\n          console.error(err)\n\n          return toast.push({\n            title: `Failed to add assignee`,\n            description: userId,\n            status: 'error',\n          })\n        })\n    },\n    [documentId, client, toast, userList]\n  )\n\n  const removeAssignee = React.useCallback(\n    (userId: string) => {\n      const user = userList.find((u) => u.id === userId)\n\n      if (!userId || !user) {\n        return toast.push({\n          status: 'error',\n          title: 'Could not find User',\n        })\n      }\n\n      return client\n        .patch(`workflow-metadata.${documentId}`)\n        .unset([`assignees[@ == \"${userId}\"]`])\n        .commit()\n        .then(() => {\n          return toast.push({\n            title: `Removed ${user.displayName} from assignees`,\n            status: 'success',\n          })\n        })\n        .catch((err) => {\n          console.error(err)\n\n          return toast.push({\n            title: `Failed to remove assignee`,\n            description: documentId,\n            status: 'error',\n          })\n        })\n    },\n    [client, toast, documentId, userList]\n  )\n\n  const clearAssignees = React.useCallback(() => {\n    return client\n      .patch(`workflow-metadata.${documentId}`)\n      .unset([`assignees`])\n      .commit()\n      .then(() => {\n        return toast.push({\n          title: `Cleared assignees`,\n          status: 'success',\n        })\n      })\n      .catch((err) => {\n        console.error(err)\n\n        return toast.push({\n          title: `Failed to clear assignees`,\n          description: documentId,\n          status: 'error',\n        })\n      })\n  }, [client, toast, documentId])\n\n  return (\n    <UserSelectMenu\n      style={{maxHeight: 300}}\n      value={assignees || []}\n      userList={userList}\n      onAdd={addAssignee}\n      onClear={clearAssignees}\n      onRemove={removeAssignee}\n    />\n  )\n}\n","import {useMemo} from 'react'\nimport {useListeningQuery} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {KeyedMetadata, Metadata} from '../types'\n\n/**\n * Takes the published ID of documents and return the metadata for those documents.\n *\n * @param ids Source document published IDs\n */\nexport function useWorkflowMetadata(ids: string[]): {\n  data: KeyedMetadata\n  loading: boolean\n  error: boolean | unknown | ProgressEvent\n} {\n  const {\n    data: rawData,\n    loading,\n    error,\n  } = useListeningQuery<Metadata[]>(\n    `*[_type == \"workflow.metadata\" && documentId in $ids]{\n      _id,\n      _type,\n      _rev,\n      assignees,\n      documentId,\n      state,\n      orderRank\n    }`,\n    {\n      params: {ids},\n      options: {apiVersion: API_VERSION},\n    }\n  )\n\n  const keyedMetadata = useMemo(() => {\n    if (!rawData || rawData.length === 0) return {}\n\n    return rawData.reduce<KeyedMetadata>((acc, cur) => {\n      return {\n        ...acc,\n        [cur.documentId]: cur,\n      }\n    }, {})\n  }, [rawData])\n\n  return {data: keyedMetadata, loading, error}\n}\n","import {useCallback, useContext, useState} from 'react'\nimport {createContext} from 'react'\nimport {LayoutProps} from 'sanity'\n\nimport {DEFAULT_CONFIG} from '../constants'\nimport {useWorkflowMetadata} from '../hooks/useWorkflowMetadata'\nimport {KeyedMetadata, WorkflowConfig} from '../types'\n\nexport type WorkflowContextValue = Required<WorkflowConfig> & {\n  data: KeyedMetadata\n  loading: boolean\n  error: boolean | unknown | ProgressEvent\n  ids: string[]\n  addId: (id: string) => void\n  removeId: (id: string) => void\n}\n\nconst WorkflowContext = createContext<WorkflowContextValue>({\n  data: {},\n  loading: false,\n  error: false,\n  ids: [],\n  addId: () => null,\n  removeId: () => null,\n  ...DEFAULT_CONFIG,\n})\n\nexport function useWorkflowContext(id?: string) {\n  const current = useContext(WorkflowContext)\n\n  return {...current, metadata: id ? current.data[id] : null}\n}\n\ntype WorkflowProviderProps = LayoutProps & {workflow: Required<WorkflowConfig>}\n\n/**\n * This Provider wraps the Studio and provides the workflow context to document actions and badges.\n * This is so individual actions and badges do not need to all register their own listeners.\n * Instead, each document \"signals\" its ID up to the provider, which then registers a single listener\n * This is performed inside of a component loaded at the root level of the Document Form\n */\nexport function WorkflowProvider(props: WorkflowProviderProps) {\n  const [ids, setIds] = useState<string[]>([])\n  const addId = useCallback(\n    (id: string) =>\n      setIds((current) => (current.includes(id) ? current : [...current, id])),\n    []\n  )\n  const removeId = useCallback(\n    (id: string) => setIds((current) => current.filter((i) => i !== id)),\n    []\n  )\n  const {data, loading, error} = useWorkflowMetadata(ids)\n\n  return (\n    <WorkflowContext.Provider\n      value={{\n        data,\n        loading,\n        error,\n        ids,\n        addId,\n        removeId,\n        states: props.workflow.states,\n        schemaTypes: props.workflow.schemaTypes,\n        filters: props.workflow.filters,\n      }}\n    >\n      {props.renderDefault(props)}\n    </WorkflowContext.Provider>\n  )\n}\n","import {useEffect, useState} from 'react'\nimport {useClient, useWorkspace} from 'sanity'\n\nexport type UserExtended = {\n  createdAt: string\n  displayName: string\n  email: string\n  familyName: string\n  givenName: string\n  id: string\n  imageUrl: string\n  isCurrentUser: boolean\n  middleName: string\n  projectId: string\n  provider: string\n  sanityUserId: string\n  updatedAt: string\n}\n\ntype UserRole = {\n  name: string\n  title: string\n}\n\ntype UserResponse = {\n  isRobot: boolean\n  projectUserId: string\n  roles: UserRole[]\n}\n\ntype HookConfig = {\n  apiVersion?: string\n}\n\nfunction chunkArray(array: any[], size: number) {\n  const chunks = []\n  for (let i = 0; i < array.length; i += size) {\n    chunks.push(array.slice(i, i + size))\n  }\n  return chunks\n}\n\n// Custom hook to fetch user details and roles in batches\nexport function useProjectUsers({apiVersion}: HookConfig): UserExtended[] {\n  const {currentUser} = useWorkspace()\n  const client = useClient({apiVersion: apiVersion ?? '2023-01-01'})\n  const [users, setUsers] = useState<UserExtended[]>([])\n\n  useEffect(() => {\n    const {projectId} = client.config()\n\n    async function getUsersWithRoles() {\n      try {\n        const aclData = await client.request({\n          url: `/projects/${projectId}/acl`,\n        })\n\n        const userIds = aclData\n          .filter((user: UserResponse) => {\n            if (user.roles.length === 1 && user.roles[0].name === 'viewer') {\n              return false\n            }\n            return true\n          })\n          .map((user: UserResponse) => user.projectUserId)\n\n        const userIdChunks = chunkArray(userIds, 200)\n\n        let usersData: UserExtended[] = []\n\n        // Fetch users in batches of 200\n        for (const chunk of userIdChunks) {\n          const chunkedUserIds = chunk.join(',')\n          const response = await client.request({\n            url: `/projects/${projectId}/users/${chunkedUserIds}`,\n          })\n          usersData = [...usersData, ...response]\n        }\n\n        // Combine user details with roles\n        const usersWithRoles = usersData.map((user: UserExtended) => {\n          const userRoles =\n            aclData.find(\n              (aclUser: UserResponse) => aclUser.projectUserId === user.id\n            )?.roles || []\n\n          return {\n            ...user,\n            isCurrentUser: user.id === currentUser?.id,\n            roles: userRoles,\n          }\n        })\n\n        setUsers(usersWithRoles)\n      } catch (err) {\n        console.error('Failed to fetch users:', err)\n      }\n    }\n\n    if (!users.length) {\n      getUsersWithRoles()\n    }\n  }, [client, currentUser?.id, users.length])\n\n  return users\n}\n","import {UsersIcon} from '@sanity/icons'\nimport {useState} from 'react'\nimport {DocumentActionProps} from 'sanity'\n\nimport UserAssignment from '../components/UserAssignment'\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\nimport {useProjectUsers} from '../hooks/useUsers'\n\nexport function AssignWorkflow(props: DocumentActionProps) {\n  const {id} = props\n  const {metadata, loading, error} = useWorkflowContext(id)\n  const [isDialogOpen, setDialogOpen] = useState(false)\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  if (error) {\n    console.error(error)\n  }\n\n  if (!metadata) {\n    return null\n  }\n\n  return {\n    icon: UsersIcon,\n    type: 'dialog',\n    disabled: !metadata || loading || error,\n    label: `Assign`,\n    title: metadata ? null : `Document is not in Workflow`,\n    dialog: isDialogOpen && {\n      type: 'popover',\n      onClose: () => {\n        setDialogOpen(false)\n      },\n      content: (\n        <UserAssignment\n          userList={userList}\n          assignees={metadata?.assignees?.length > 0 ? metadata.assignees : []}\n          documentId={id}\n        />\n      ),\n    },\n    onHandle: () => {\n      setDialogOpen(true)\n    },\n  }\n}\n","import {SplitVerticalIcon} from '@sanity/icons'\nimport {useToast} from '@sanity/ui'\nimport {LexoRank} from 'lexorank'\nimport {useCallback, useState} from 'react'\nimport {DocumentActionProps, useClient} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\n\nexport function BeginWorkflow(props: DocumentActionProps) {\n  const {id, draft} = props\n  const {metadata, loading, error, states} = useWorkflowContext(id)\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n  const [beginning, setBeginning] = useState(false)\n  const [complete, setComplete] = useState(false)\n\n  if (error) {\n    console.error(error)\n  }\n\n  const handle = useCallback(async () => {\n    setBeginning(true)\n\n    const lowestOrderFirstState = await client.fetch(\n      `*[_type == \"workflow.metadata\" && state == $state]|order(orderRank)[0].orderRank`,\n      {state: states[0].id}\n    )\n\n    client\n      .createIfNotExists({\n        _id: `workflow-metadata.${id}`,\n        _type: `workflow.metadata`,\n        documentId: id,\n        state: states[0].id,\n        orderRank: lowestOrderFirstState\n          ? LexoRank.parse(lowestOrderFirstState).genNext().toString()\n          : LexoRank.min().toString(),\n        locale: draft?.locale,\n      })\n      .then(() => {\n        toast.push({\n          status: 'success',\n          title: 'Workflow started',\n          description: `Document is now \"${states[0].title}\"`,\n        })\n        setBeginning(false)\n        // Optimistically remove action\n        setComplete(true)\n      })\n  }, [id, states, client, toast, draft])\n\n  if (!draft || complete || metadata) {\n    return null\n  }\n\n  return {\n    icon: SplitVerticalIcon,\n    type: 'dialog',\n    disabled: metadata || loading || error || beginning || complete,\n    label: beginning ? `Beginning...` : `Begin Workflow`,\n    onHandle: () => {\n      handle()\n    },\n  }\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {useCallback} from 'react'\nimport {DocumentActionProps, useClient} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\n\nexport function CompleteWorkflow(props: DocumentActionProps) {\n  const {id} = props\n  const {metadata, loading, error, states} = useWorkflowContext(id)\n  const client = useClient({apiVersion: API_VERSION})\n\n  if (error) {\n    console.error(error)\n  }\n\n  const handle = useCallback(() => {\n    client.delete(`workflow-metadata.${id}`)\n  }, [id, client])\n\n  if (!metadata) {\n    return null\n  }\n\n  const state = states.find((s) => s.id === metadata.state)\n  const isLastState = state?.id === states[states.length - 1].id\n\n  return {\n    icon: CheckmarkIcon,\n    type: 'dialog',\n    disabled: loading || error || !isLastState,\n    label: `Complete Workflow`,\n    title: isLastState\n      ? `Removes the document from the Workflow process`\n      : `Cannot remove from workflow until in the last state`,\n    onHandle: () => {\n      handle()\n    },\n    color: 'positive',\n  }\n}\n","export function arraysContainMatchingString(\n  one: string[],\n  two: string[]\n): boolean {\n  return one.some((item) => two.includes(item))\n}\n","import {ArrowLeftIcon, ArrowRightIcon} from '@sanity/icons'\nimport {useToast} from '@sanity/ui'\nimport {useCurrentUser, useValidationStatus} from 'sanity'\nimport {DocumentActionProps, useClient} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\nimport {arraysContainMatchingString} from '../helpers/arraysContainMatchingString'\nimport {State} from '../types'\n\n// eslint-disable-next-line complexity\nexport function UpdateWorkflow(props: DocumentActionProps, actionState: State) {\n  const {id, type} = props\n\n  const user = useCurrentUser()\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n  const currentUser = useCurrentUser()\n\n  const {metadata, loading, error, states} = useWorkflowContext(id)\n  const currentState = states.find((s) => s.id === metadata?.state)\n  const {assignees = []} = metadata ?? {}\n\n  // TODO: Shouldn't the document action props contain this?\n  const {validation, isValidating} = useValidationStatus(id, type)\n  const hasValidationErrors =\n    currentState?.requireValidation &&\n    !isValidating &&\n    validation?.length > 0 &&\n    validation.find((v) => v.level === 'error')\n\n  if (error) {\n    console.error(error)\n  }\n\n  const onHandle = (documentId: string, newState: State) => {\n    client\n      .patch(`workflow-metadata.${documentId}`)\n      .set({state: newState.id})\n      .commit()\n      .then(() => {\n        props.onComplete()\n        toast.push({\n          status: 'success',\n          title: `Document state now \"${newState.title}\"`,\n        })\n      })\n      .catch((err) => {\n        props.onComplete()\n        console.error(err)\n        toast.push({\n          status: 'error',\n          title: `Document state update failed`,\n        })\n      })\n  }\n\n  // Remove button if:\n  // Document is not in Workflow OR\n  // The current State is the same as this actions State\n  if (!metadata || (currentState && currentState.id === actionState.id)) {\n    return null\n  }\n\n  const currentStateIndex = states.findIndex((s) => s.id === currentState?.id)\n  const actionStateIndex = states.findIndex((s) => s.id === actionState.id)\n  const direction = actionStateIndex > currentStateIndex ? 'promote' : 'demote'\n  const DirectionIcon = direction === 'promote' ? ArrowRightIcon : ArrowLeftIcon\n  const directionLabel = direction === 'promote' ? 'Promote' : 'Demote'\n\n  const userRoleCanUpdateState =\n    user?.roles?.length && actionState?.roles?.length\n      ? // If the Action state is limited to specific roles\n        // check that the current user has one of those roles\n        arraysContainMatchingString(\n          user.roles.map((r) => r.name),\n          actionState.roles\n        )\n      : // No roles specified on the next state, so anyone can update\n        actionState?.roles?.length !== 0\n\n  const actionStateIsAValidTransition =\n    currentState?.id && currentState?.transitions?.length\n      ? // If the Current State limits transitions to specific States\n        // Check that the Action State is in Current State's transitions array\n        currentState.transitions.includes(actionState.id)\n      : // Otherwise this isn't a problem\n        true\n\n  const userAssignmentCanUpdateState = actionState.requireAssignment\n    ? // If the Action State requires assigned users\n      // Check the current user ID is in the assignees array\n      currentUser && assignees?.length && assignees.includes(currentUser.id)\n    : // Otherwise this isn't a problem\n      true\n\n  let title = `${directionLabel} State to \"${actionState.title}\"`\n\n  if (!userRoleCanUpdateState) {\n    title = `Your User role cannot ${directionLabel} State to \"${actionState.title}\"`\n  } else if (!actionStateIsAValidTransition) {\n    title = `You cannot ${directionLabel} State to \"${actionState.title}\" from \"${currentState?.title}\"`\n  } else if (!userAssignmentCanUpdateState) {\n    title = `You must be assigned to the document to ${directionLabel} State to \"${actionState.title}\"`\n  } else if (currentState?.requireValidation && isValidating) {\n    title = `Document is validating, cannot ${directionLabel} State to \"${actionState.title}\"`\n  } else if (hasValidationErrors) {\n    title = `Document has validation errors, cannot ${directionLabel} State to \"${actionState.title}\"`\n  }\n\n  return {\n    icon: DirectionIcon,\n    disabled:\n      loading ||\n      error ||\n      (currentState?.requireValidation && isValidating) ||\n      hasValidationErrors ||\n      !currentState ||\n      !userRoleCanUpdateState ||\n      !actionStateIsAValidTransition ||\n      !userAssignmentCanUpdateState,\n    title,\n    label: actionState.title,\n    onHandle: () => onHandle(id, actionState),\n  }\n}\n","import {CurrentUser, DocumentBadgeDescription} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\nimport {API_VERSION} from '../constants'\nimport {useProjectUsers} from '../hooks/useUsers'\n\nexport function AssigneesBadge(\n  documentId: string,\n  currentUser: CurrentUser | null\n): DocumentBadgeDescription | null {\n  const {metadata, loading, error} = useWorkflowContext(documentId)\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  if (loading || error || !metadata) {\n    if (error) {\n      console.error(error)\n    }\n\n    return null\n  }\n\n  if (!metadata?.assignees?.length) {\n    return {\n      label: 'Unassigned',\n    }\n  }\n\n  const {assignees} = metadata ?? []\n  const hasMe = currentUser\n    ? assignees.some((assignee) => assignee === currentUser.id)\n    : false\n  const assigneesCount = hasMe ? assignees.length - 1 : assignees.length\n  const assigneeUsers = userList.filter((user) => assignees.includes(user.id))\n  const title = assigneeUsers.map((user) => user.displayName).join(', ')\n\n  let label\n\n  if (hasMe && assigneesCount === 0) {\n    label = 'Assigned to Me'\n  } else if (hasMe && assigneesCount > 0) {\n    label = `Me and ${assigneesCount} ${\n      assigneesCount === 1 ? 'other' : 'others'\n    }`\n  } else {\n    label = `${assigneesCount} assigned`\n  }\n\n  return {\n    label,\n    title,\n    color: 'primary',\n  }\n}\n","import {DocumentBadgeDescription} from 'sanity'\n\nimport {useWorkflowContext} from '../components/WorkflowContext'\n\nexport function StateBadge(\n  documentId: string\n): DocumentBadgeDescription | null {\n  const {metadata, loading, error, states} = useWorkflowContext(documentId)\n  const state = states.find((s) => s.id === metadata?.state)\n\n  if (loading || error) {\n    if (error) {\n      console.error(error)\n    }\n\n    return null\n  }\n\n  if (!state) {\n    return null\n  }\n\n  return {\n    label: state.title,\n    // title: state.title,\n    color: state?.color,\n  }\n}\n","import {useEffect} from 'react'\nimport {ObjectInputProps} from 'sanity'\n\nimport {useWorkflowContext} from './WorkflowContext'\n\n// This component is loaded at the root level of the Document Form\n// It is used to signal the document ID to the WorkflowProvider\nexport default function WorkflowSignal(props: ObjectInputProps) {\n  const documentId = props?.value?._id\n    ? props.value._id.replace(`drafts.`, ``)\n    : null\n\n  const {addId, removeId} = useWorkflowContext()\n\n  useEffect(() => {\n    // On mount, add  to the query of listening documents\n    if (documentId) {\n      addId(documentId)\n    }\n\n    // On unmount, remove from the query of listening documents\n    return () => {\n      if (documentId) {\n        removeId(documentId)\n      }\n    }\n  }, [documentId, addId, removeId])\n\n  return props.renderDefault(props)\n}\n","import {Button} from '@sanity/ui'\nimport {EditIcon} from '@sanity/icons'\nimport {useRouter} from 'sanity/router'\n\ntype EditButtonProps = {\n  id: string\n  type: string\n  disabled?: boolean\n}\n\nexport default function EditButton(props: EditButtonProps) {\n  const {id, type, disabled = false} = props\n  const {navigateIntent} = useRouter()\n\n  return (\n    <Button\n      // eslint-disable-next-line react/jsx-no-bind\n      onClick={() => navigateIntent('edit', {id, type})}\n      mode=\"ghost\"\n      fontSize={1}\n      padding={2}\n      tabIndex={-1}\n      icon={EditIcon}\n      text=\"Edit\"\n      disabled={disabled}\n    />\n  )\n}\n","import {Flex, Card, Spinner} from '@sanity/ui'\nimport {Preview, SanityDocument, StringInputProps, useSchema} from 'sanity'\nimport {useListeningQuery, Feedback} from 'sanity-plugin-utils'\n\nimport EditButton from './EditButton'\n\n// TODO: Update this to use the same component as the Tool\nexport default function Field(props: StringInputProps) {\n  const schema = useSchema()\n  const {data, loading, error} = useListeningQuery<SanityDocument>(\n    `*[_id in [$id, $draftId]]|order(_updatedAt)[0]`,\n    {\n      params: {\n        id: String(props.value),\n        draftId: `drafts.${String(props.value)}`,\n      },\n    }\n  )\n\n  if (loading) {\n    return <Spinner />\n  }\n\n  const schemaType = schema.get(data?._type ?? ``)\n\n  if (error || !data?._type || !schemaType) {\n    return <Feedback tone=\"critical\" title=\"Error with query\" />\n  }\n\n  return (\n    <Card border padding={2}>\n      <Flex align=\"center\" justify=\"space-between\" gap={2}>\n        <Preview layout=\"default\" value={data} schemaType={schemaType} />\n        <EditButton id={data._id} type={data._type} />\n      </Flex>\n    </Card>\n  )\n}\n","import {Card} from '@sanity/ui'\nimport {FunctionComponent} from 'react'\nimport {\n  ArrayOfPrimitivesInputProps,\n  ArraySchemaType,\n  useFormValue,\n} from 'sanity'\n\nimport {API_VERSION} from '../constants'\nimport {useProjectUsers} from '../hooks/useUsers'\nimport UserAssignment from './UserAssignment'\n\nconst UserAssignmentInput: FunctionComponent<\n  ArrayOfPrimitivesInputProps<string | number | boolean, ArraySchemaType>\n> = (props) => {\n  const documentId = useFormValue([`documentId`])\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  const stringValue =\n    Array.isArray(props?.value) && props?.value?.length\n      ? props.value.map((item) => String(item))\n      : []\n\n  return (\n    <Card border padding={1}>\n      <UserAssignment\n        userList={userList}\n        assignees={stringValue}\n        documentId={String(documentId)}\n      />\n    </Card>\n  )\n}\n\nexport default UserAssignmentInput\n","import {LexoRank} from 'lexorank'\n\n// Use in initial value field by passing in the rank value of the last document\n// If not value passed, generate a sensibly low rank\nexport default function initialRank(lastRankValue = ``): string {\n  const lastRank =\n    lastRankValue && typeof lastRankValue === 'string'\n      ? LexoRank.parse(lastRankValue)\n      : LexoRank.min()\n  const nextRank = lastRank.genNext().genNext()\n\n  return (nextRank as any).value\n}\n","import {defineField, defineType} from 'sanity'\n\nimport Field from '../../components/DocumentCard/Field'\nimport UserAssignmentInput from '../../components/UserAssignmentInput'\nimport {API_VERSION} from '../../constants'\nimport initialRank from '../../helpers/initialRank'\nimport {State} from '../../types'\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport default (states: State[]) =>\n  defineType({\n    type: 'document',\n    name: 'workflow.metadata',\n    title: 'Workflow metadata',\n    liveEdit: true,\n    fields: [\n      defineField({\n        name: 'state',\n        description: `The current \"State\" of the document. Field is read only as changing it would not fire the state's \"operation\" setting. These are fired in the Document Actions and in the custom Tool.`,\n        readOnly: true,\n        type: 'string',\n        options: {\n          list: states.length\n            ? states.map((state) => ({\n                value: state.id,\n                title: state.title,\n              }))\n            : [],\n          layout: 'radio',\n        },\n      }),\n      defineField({\n        name: 'documentId',\n        title: 'Document ID',\n        description:\n          'Used to help identify the target document that this metadata is tracking state for.',\n        type: 'string',\n        readOnly: true,\n        components: {\n          input: Field,\n        },\n      }),\n      defineField({\n        name: 'orderRank',\n        description: 'Used to maintain order position of cards in the Tool.',\n        type: 'string',\n        readOnly: true,\n        initialValue: async (p, {getClient}) => {\n          const lastDocOrderRank = await getClient({\n            apiVersion: API_VERSION,\n          }).fetch(`*[_type == $type]|order(@[$order] desc)[0][$order]`, {\n            order: `orderRank`,\n            type: `workflow.metadata`,\n          })\n\n          return initialRank(lastDocOrderRank)\n        },\n      }),\n      defineField({\n        type: 'array',\n        name: 'assignees',\n        of: [{type: 'string'}],\n        components: {\n          input: UserAssignmentInput,\n        },\n      }),\n    ],\n  })\n","import {SanityDocumentWithMetadata} from '../types'\n\nexport function filterItemsAndSort(\n  items: SanityDocumentWithMetadata[],\n  stateId: string,\n  selectedUsers: string[] = [],\n  selectedSchemaTypes: null | string[] = []\n): SanityDocumentWithMetadata[] {\n  return (\n    items\n      // Only items that have existing documents\n      .filter((item) => item?._id)\n      // Only items of this state\n      .filter((item) => item?._metadata?.state === stateId)\n      // Only items with selected users, if the document has any assigned users\n      .filter((item) =>\n        selectedUsers.length && item._metadata?.assignees?.length\n          ? item._metadata?.assignees.some((assignee) =>\n              selectedUsers.includes(assignee)\n            )\n          : !selectedUsers.length\n      )\n      // Only items of selected schema types, if any are selected\n      .filter((item) => {\n        if (!selectedSchemaTypes) {\n          return true\n        }\n\n        return selectedSchemaTypes.length\n          ? selectedSchemaTypes.includes(item._type)\n          : false\n      })\n      // Sort by metadata orderRank, a string field\n      .sort((a, b) => {\n        const aOrderRank = a._metadata?.orderRank || '0'\n        const bOrderRank = b._metadata?.orderRank || '0'\n\n        return aOrderRank.localeCompare(bOrderRank)\n      })\n  )\n}\n","import {DraggableLocation} from '@hello-pangea/dnd'\nimport {useToast} from '@sanity/ui'\nimport groq from 'groq'\nimport React from 'react'\nimport {useClient} from 'sanity'\nimport {useListeningQuery} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {FilterOptions, SanityDocumentWithMetadata, State} from '../types'\n\ntype WorkflowDocuments = {\n  workflowData: {\n    data: SanityDocumentWithMetadata[]\n    loading: boolean\n    error: boolean | unknown | ProgressEvent\n  }\n  operations: {\n    move: (\n      draggedId: string,\n      destination: DraggableLocation,\n      states: State[],\n      newOrder: string\n    ) => void\n  }\n}\n\nexport function useWorkflowDocuments(\n  schemaTypes: string[],\n  filterOptions?: FilterOptions\n): WorkflowDocuments {\n  const toast = useToast()\n  const client = useClient({apiVersion: API_VERSION})\n\n  const localeFilter = filterOptions?.locales?.length\n    ? filterOptions.locales\n    : []\n\n  const QUERY = groq`*[_type == \"workflow.metadata\" (!defined($localeFilter) || count($localeFilter) == 0 || locale in $localeFilter)]|order(orderRank){\n    \"_metadata\": {\n      _rev,\n      assignees,\n      documentId,\n      state,\n      orderRank,\n      \"draftDocumentId\": \"drafts.\" + documentId,\n    }\n  }{\n    ...,\n    ...(\n      *[_id == ^._metadata.documentId || _id == ^._metadata.draftDocumentId]|order(_updatedAt)[0]{ \n        _id, \n        _type, \n        _rev, \n        _updatedAt \n      }\n    )\n  }`\n\n  // Get and listen to changes on documents + workflow metadata documents\n  const {data, loading, error} = useListeningQuery<\n    SanityDocumentWithMetadata[]\n  >(QUERY, {\n    params: {schemaTypes, localeFilter},\n    initialValue: [],\n  })\n\n  const [localDocuments, setLocalDocuments] = React.useState<\n    SanityDocumentWithMetadata[]\n  >([])\n\n  React.useEffect(() => {\n    if (data) {\n      setLocalDocuments(data)\n    }\n  }, [data])\n\n  const move = React.useCallback(\n    async (\n      draggedId: string,\n      destination: DraggableLocation,\n      states: State[],\n      newOrder: string\n    ) => {\n      // Optimistic update\n      const currentLocalData = localDocuments\n      const newLocalDocuments = localDocuments.map((item) => {\n        if (item?._metadata?.documentId === draggedId) {\n          return {\n            ...item,\n            _metadata: {\n              ...item._metadata,\n              state: destination.droppableId,\n              orderRank: newOrder,\n              // This value won't be written to the document\n              // It's done so that un/publish operations don't happen twice\n              // Because a moved document's card will update once optimistically\n              // and then again when the document is updated\n              optimistic: true,\n            },\n          }\n        }\n\n        return item\n      })\n\n      setLocalDocuments(newLocalDocuments)\n\n      // Now client-side update\n      const newStateId = destination.droppableId\n      const newState = states.find((s) => s.id === newStateId)\n      const document = localDocuments.find(\n        (d) => d?._metadata?.documentId === draggedId\n      )\n\n      if (!newState?.id) {\n        toast.push({\n          title: `Could not find target state ${newStateId}`,\n          status: 'error',\n        })\n        return null\n      }\n\n      if (!document) {\n        toast.push({\n          title: `Could not find dragged document in data`,\n          status: 'error',\n        })\n        return null\n      }\n\n      // We need to know if it's a draft or not\n      const {_id, _type} = document\n\n      // Metadata + useDocumentOperation always uses Published id\n      const {documentId, _rev} = document._metadata || {}\n\n      await client\n        .patch(`workflow-metadata.${documentId}`)\n        .ifRevisionId(_rev)\n        .set({state: newStateId, orderRank: newOrder})\n        .commit()\n        .then((res) => {\n          toast.push({\n            title:\n              newState.id === document._metadata.state\n                ? `Reordered in \"${newState?.title ?? newStateId}\"`\n                : `Moved to \"${newState?.title ?? newStateId}\"`,\n            status: 'success',\n          })\n          return res\n        })\n        .catch((err) => {\n          // Revert optimistic update\n          setLocalDocuments(currentLocalData)\n\n          toast.push({\n            title: `Failed to move to \"${newState?.title ?? newStateId}\"`,\n            description: err.message,\n            status: 'error',\n          })\n          return null\n        })\n\n      // Send back to the workflow board so a document update can happen\n      return {_id, _type, documentId, state: newState as State}\n    },\n    [client, toast, localDocuments]\n  )\n\n  return {\n    workflowData: {data: localDocuments, loading, error},\n    operations: {move},\n  }\n}\n","import React from 'react'\nimport {Box, Flex, Text} from '@sanity/ui'\nimport {useCurrentUser, UserAvatar} from 'sanity'\n\nimport {User} from '../../types'\n\ntype AvatarGroupProps = {\n  users: User[]\n  max?: number\n}\n\nexport default function AvatarGroup(props: AvatarGroupProps) {\n  const currentUser = useCurrentUser()\n  const {users, max = 4} = props\n\n  const len = users?.length\n  const {me, visibleUsers} = React.useMemo(() => {\n    return {\n      me: currentUser?.id ? users.find((u) => u.id === currentUser.id) : undefined,\n      visibleUsers: users.filter((u) => u.id !== currentUser?.id).slice(0, max - 1),\n    }\n  }, [users, max, currentUser])\n\n  if (!users?.length) {\n    return null\n  }\n\n  return (\n    <Flex align=\"center\" gap={1}>\n      {me ? <UserAvatar user={me} /> : null}\n      {visibleUsers.map((user) => (\n        <Box key={user.id} style={{marginRight: -8}}>\n          <UserAvatar user={user} />\n        </Box>\n      ))}\n      {len > max && (\n        <Box paddingLeft={2}>\n          <Text size={1}>+{len - max}</Text>\n        </Box>\n      )}\n    </Flex>\n  )\n}\n","import React from 'react'\nimport {Button, Grid, Popover, useClickOutside} from '@sanity/ui'\nimport {AddIcon} from '@sanity/icons'\n\nimport AvatarGroup from './DocumentCard/AvatarGroup'\nimport {User} from '../types'\nimport UserAssignment from './UserAssignment'\n\ntype UserDisplayProps = {\n  userList: User[]\n  assignees: string[]\n  documentId: string\n  disabled?: boolean\n}\n\nexport default function UserDisplay(props: UserDisplayProps) {\n  const {assignees, userList, documentId, disabled = false} = props\n\n  const [button] = React.useState(null)\n  const [popover, setPopover] = React.useState(null)\n  const [isOpen, setIsOpen] = React.useState(false)\n\n  const close = React.useCallback(() => setIsOpen(false), [])\n  const open = React.useCallback(() => setIsOpen(true), [])\n\n  useClickOutside(close, [button, popover])\n\n  return (\n    <Popover\n      // @ts-ignore\n      ref={setPopover}\n      content={<UserAssignment userList={userList} assignees={assignees} documentId={documentId} />}\n      portal\n      open={isOpen}\n    >\n      {!assignees || assignees.length === 0 ? (\n        <Button\n          onClick={open}\n          fontSize={1}\n          padding={2}\n          tabIndex={-1}\n          icon={AddIcon}\n          text=\"Assign\"\n          tone=\"positive\"\n          mode=\"ghost\"\n          disabled={disabled}\n        />\n      ) : (\n        <Grid>\n          <Button onClick={open} padding={0} mode=\"bleed\" disabled={disabled}>\n            <AvatarGroup users={userList.filter((u) => assignees.includes(u.id))} />\n          </Button>\n        </Grid>\n      )}\n    </Popover>\n  )\n}\n","import {CheckmarkIcon} from '@sanity/icons'\nimport {\n  Box,\n  Button,\n  Text,\n  ToastContextValue,\n  Tooltip,\n  useToast,\n} from '@sanity/ui'\nimport React from 'react'\nimport {SanityClient, useClient} from 'sanity'\n\nimport {API_VERSION} from '../../constants'\n\ntype CompleteButtonProps = {\n  documentId: string\n  disabled: boolean\n}\n\nasync function moveDraftToPublished(\n  client: SanityClient,\n  publishedId: string,\n  toast: ToastContextValue\n) {\n  const draftId = `drafts.${publishedId}`\n\n  try {\n    const draftDoc = await client.getDocument(draftId)\n\n    if (!draftDoc) {\n      toast.push({\n        status: 'error',\n        title: `No draft document found with _id:', ${draftId}`,\n      })\n      return\n    }\n\n    await client.createOrReplace({\n      ...draftDoc,\n      _id: publishedId,\n    })\n\n    toast.push({\n      status: 'success',\n      title: `Document published successfully with _id:', ${publishedId}`,\n    })\n\n    await client.delete(draftId)\n    toast.push({\n      status: 'success',\n      title: `Draft document deleted successfully::', ${draftId}`,\n    })\n  } catch (error) {\n    console.error('Error publishing the document:', error)\n  }\n}\n\nexport default function CompleteButton(props: CompleteButtonProps) {\n  const {documentId, disabled = false} = props\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n\n  const handleComplete: React.MouseEventHandler<HTMLButtonElement> =\n    React.useCallback(\n      (event) => {\n        const id = event.currentTarget.value\n\n        if (!id) {\n          return\n        }\n\n        // publish the document\n        moveDraftToPublished(client, id, toast)\n\n        client\n          .delete(`workflow-metadata.${id}`)\n          .then(() => {\n            toast.push({\n              status: 'success',\n              title: 'Workflow completed',\n            })\n          })\n          .catch(() => {\n            toast.push({\n              status: 'error',\n              title: 'Could not complete Workflow',\n            })\n          })\n      },\n      [client, toast]\n    )\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>Remove this document from Workflow</Text>\n        </Box>\n      }\n    >\n      <Button\n        value={documentId}\n        onClick={handleComplete}\n        text=\"Complete\"\n        icon={CheckmarkIcon}\n        tone=\"positive\"\n        mode=\"ghost\"\n        fontSize={1}\n        padding={2}\n        tabIndex={-1}\n        disabled={disabled}\n      />\n    </Tooltip>\n  )\n}\n","import {useTimeAgo} from 'sanity'\n\nexport interface TimeAgoProps {\n  time: string | Date\n}\n\nexport function TimeAgo({time}: TimeAgoProps) {\n  const timeAgo = useTimeAgo(time)\n\n  return <span title={timeAgo}>{timeAgo} ago</span>\n}\n","import {EditIcon} from '@sanity/icons'\nimport {PreviewValue, SanityDocument} from '@sanity/types'\nimport {Box, Text, Tooltip} from '@sanity/ui'\nimport {TextWithTone} from 'sanity'\n\nimport {TimeAgo} from './TimeAgo'\n\nexport function DraftStatus(props: {document?: PreviewValue | Partial<SanityDocument> | null}) {\n  const {document} = props\n  const updatedAt = document && '_updatedAt' in document && document._updatedAt\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>\n            {document ? (\n              <>Edited {updatedAt && <TimeAgo time={updatedAt} />}</>\n            ) : (\n              <>No unpublished edits</>\n            )}\n          </Text>\n        </Box>\n      }\n    >\n      <TextWithTone tone=\"caution\" dimmed={!document} muted={!document} size={1}>\n        <EditIcon />\n      </TextWithTone>\n    </Tooltip>\n  )\n}\n","import {PublishIcon} from '@sanity/icons'\nimport {PreviewValue, SanityDocument} from '@sanity/types'\nimport {Box, Text, Tooltip} from '@sanity/ui'\nimport {TextWithTone} from 'sanity'\n\nimport {TimeAgo} from './TimeAgo'\n\nexport function PublishedStatus(props: {\n  document?: PreviewValue | Partial<SanityDocument> | null\n}) {\n  const {document} = props\n  const updatedAt = document && '_updatedAt' in document && document._updatedAt\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>\n            {document ? (\n              <>Published {updatedAt && <TimeAgo time={updatedAt} />}</>\n            ) : (\n              <>Not published</>\n            )}\n          </Text>\n        </Box>\n      }\n    >\n      <TextWithTone\n        tone=\"positive\"\n        dimmed={!document}\n        muted={!document}\n        size={1}\n      >\n        <PublishIcon />\n      </TextWithTone>\n    </Tooltip>\n  )\n}\n","import {useEffect} from 'react'\nimport {useValidationStatus, ValidationStatus} from 'sanity'\n\ntype ValidateProps = {\n  documentId: string\n  type: string\n  onChange: (validation: ValidationStatus) => void\n}\n\n// Document validation is siloed into its own component\n// Because it's not performant to run on a lot of documents\nexport default function Validate(props: ValidateProps) {\n  const {documentId, type, onChange} = props\n  const {isValidating, validation = []} = useValidationStatus(documentId, type)\n\n  useEffect(() => {\n    onChange({isValidating, validation})\n  }, [onChange, isValidating, validation])\n\n  return null\n}\n","import {ErrorOutlineIcon, WarningOutlineIcon} from '@sanity/icons'\nimport {ValidationMarker} from '@sanity/types'\nimport {Box, Text, Tooltip} from '@sanity/ui'\nimport {TextWithTone} from 'sanity'\n\ntype ValidationStatusProps = {\n  validation: ValidationMarker[]\n}\n\nexport function ValidationStatus(props: ValidationStatusProps) {\n  const {validation = []} = props\n\n  if (!validation.length) {\n    return null\n  }\n\n  const hasError = validation.some((item) => item.level === 'error')\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>\n            {validation.length === 1\n              ? `1 validation issue`\n              : `${validation.length} validation issues`}\n          </Text>\n        </Box>\n      }\n    >\n      <TextWithTone tone={hasError ? `critical` : `caution`} size={1}>\n        {hasError ? <ErrorOutlineIcon /> : <WarningOutlineIcon />}\n      </TextWithTone>\n    </Tooltip>\n  )\n}\n","/* eslint-disable react/prop-types */\nimport {DragHandleIcon} from '@sanity/icons'\nimport {Box, Card, CardTone, Flex, Stack, useTheme} from '@sanity/ui'\nimport {useCallback, useEffect, useMemo, useState} from 'react'\nimport {\n  SchemaType,\n  useSchema,\n  ValidationStatus as ValidationStatusType,\n} from 'sanity'\nimport {Preview} from 'sanity'\n\nimport {SanityDocumentWithMetadata, State, User} from '../../types'\nimport UserDisplay from '../UserDisplay'\nimport CompleteButton from './CompleteButton'\nimport {DraftStatus} from './core/DraftStatus'\nimport {PublishedStatus} from './core/PublishedStatus'\nimport EditButton from './EditButton'\nimport Validate from './Validate'\nimport {ValidationStatus} from './ValidationStatus'\n\ntype DocumentCardProps = {\n  isDragDisabled: boolean\n  isPatching: boolean\n  userRoleCanDrop: boolean\n  isDragging: boolean\n  item: SanityDocumentWithMetadata\n  states: State[]\n  toggleInvalidDocumentId: (\n    documentId: string,\n    action: 'ADD' | 'REMOVE'\n  ) => void\n  userList: User[]\n}\n\nexport function DocumentCard(props: DocumentCardProps) {\n  const {\n    isDragDisabled,\n    isPatching,\n    userRoleCanDrop,\n    isDragging,\n    item,\n    states,\n    toggleInvalidDocumentId,\n    userList,\n  } = props\n  const {assignees = [], documentId} = item._metadata ?? {}\n  const schema = useSchema()\n  const state = states.find((s) => s.id === item._metadata?.state)\n\n  const isDarkMode = useTheme().sanity.color.dark\n  const defaultCardTone = isDarkMode ? `transparent` : `default`\n\n  // Validation only runs if the state requests it\n  // Because it's not performant to run it on many documents simultaneously\n  // So we fake it here, and maybe set it inside <Validate />\n  const [optimisticValidation, setOptimisticValidation] =\n    useState<ValidationStatusType>({\n      isValidating: state?.requireValidation ?? false,\n      validation: [],\n    })\n\n  const {isValidating, validation} = optimisticValidation\n\n  const handleValidation = useCallback((updates: ValidationStatusType) => {\n    setOptimisticValidation(updates)\n  }, [])\n\n  const cardTone = useMemo(() => {\n    let tone: CardTone = defaultCardTone\n\n    if (!userRoleCanDrop) return isDarkMode ? `default` : `transparent`\n    if (!documentId) return tone\n    if (isPatching) tone = isDarkMode ? `default` : `transparent`\n    if (isDragging) tone = `positive`\n\n    if (state?.requireValidation && !isValidating && validation.length > 0) {\n      if (validation.some((v) => v.level === 'error')) {\n        tone = `critical`\n      } else {\n        tone = `caution`\n      }\n    }\n\n    return tone\n  }, [\n    defaultCardTone,\n    userRoleCanDrop,\n    isPatching,\n    isDarkMode,\n    documentId,\n    isDragging,\n    isValidating,\n    validation,\n    state?.requireValidation,\n  ])\n\n  // Update validation status\n  // Cannot be done in the above memo because it would set state during render\n  useEffect(() => {\n    if (!isValidating && validation.length > 0) {\n      if (validation.some((v) => v.level === 'error')) {\n        toggleInvalidDocumentId(documentId, 'ADD')\n      } else {\n        toggleInvalidDocumentId(documentId, 'REMOVE')\n      }\n    } else {\n      toggleInvalidDocumentId(documentId, 'REMOVE')\n    }\n  }, [documentId, isValidating, toggleInvalidDocumentId, validation])\n\n  const hasError = useMemo(\n    () => (isValidating ? false : validation.some((v) => v.level === 'error')),\n    [isValidating, validation]\n  )\n\n  const isLastState = useMemo(\n    () => states[states.length - 1].id === item._metadata?.state,\n    [states, item._metadata.state]\n  )\n\n  return (\n    <>\n      {state?.requireValidation ? (\n        <Validate\n          documentId={documentId}\n          type={item._type}\n          onChange={handleValidation}\n        />\n      ) : null}\n      <Box paddingBottom={3} paddingX={3}>\n        <Card radius={2} shadow={isDragging ? 3 : 1} tone={cardTone}>\n          <Stack>\n            <Card\n              borderBottom\n              radius={2}\n              paddingRight={2}\n              tone={cardTone}\n              style={{pointerEvents: 'none'}}\n            >\n              <Flex align=\"center\" justify=\"space-between\" gap={1}>\n                <Box flex={1}>\n                  <Preview\n                    layout=\"default\"\n                    skipVisibilityCheck\n                    value={item}\n                    schemaType={schema.get(item._type) as SchemaType}\n                  />\n                </Box>\n                <Box style={{flexShrink: 0}}>\n                  {hasError || isDragDisabled || isPatching ? null : (\n                    <DragHandleIcon />\n                  )}\n                </Box>\n              </Flex>\n            </Card>\n\n            <Card padding={2} radius={2} tone=\"inherit\">\n              <Flex align=\"center\" justify=\"space-between\" gap={3}>\n                <Box flex={1}>\n                  {documentId && (\n                    <UserDisplay\n                      userList={userList}\n                      assignees={assignees}\n                      documentId={documentId}\n                      disabled={!userRoleCanDrop}\n                    />\n                  )}\n                </Box>\n                {validation.length > 0 ? (\n                  <ValidationStatus validation={validation} />\n                ) : null}\n                <DraftStatus document={item} />\n                <PublishedStatus document={item} />\n                <EditButton\n                  id={item._id}\n                  type={item._type}\n                  disabled={!userRoleCanDrop}\n                />\n                {isLastState && states.length <= 3 ? (\n                  <CompleteButton\n                    documentId={documentId}\n                    disabled={!userRoleCanDrop}\n                  />\n                ) : null}\n              </Flex>\n              {isLastState && states.length > 3 ? (\n                <Stack paddingTop={2}>\n                  <CompleteButton\n                    documentId={documentId}\n                    disabled={!userRoleCanDrop}\n                  />\n                </Stack>\n              ) : null}\n            </Card>\n          </Stack>\n        </Card>\n      </Box>\n    </>\n  )\n}\n","import {Draggable, DraggableStyle} from '@hello-pangea/dnd'\nimport {useVirtualizer, VirtualItem} from '@tanstack/react-virtual'\nimport {CSSProperties, useMemo, useRef} from 'react'\nimport {CurrentUser} from 'sanity'\nimport {UserExtended} from 'sanity-plugin-utils'\n\nimport {filterItemsAndSort} from '../helpers/filterItemsAndSort'\nimport {SanityDocumentWithMetadata, State} from '../types'\nimport {DocumentCard} from './DocumentCard'\n\ntype DocumentListProps = {\n  data: SanityDocumentWithMetadata[]\n  invalidDocumentIds: string[]\n  patchingIds: string[]\n  selectedSchemaTypes: string[]\n  selectedUserIds: string[]\n  state: State\n  states: State[]\n  toggleInvalidDocumentId: (\n    documentId: string,\n    action: 'ADD' | 'REMOVE'\n  ) => void\n  user: CurrentUser | null\n  userList: UserExtended[]\n  userRoleCanDrop: boolean\n}\n\nfunction getStyle(\n  draggableStyle: DraggableStyle | undefined,\n  virtualItem: VirtualItem\n): CSSProperties {\n  // Default transform required by tanstack virtual for positioning\n  let transform = `translateY(${virtualItem.start}px)`\n\n  // If a card is being dragged over, this card needs to move up or down\n  if (draggableStyle && draggableStyle.transform) {\n    // So get the transform value from beautiful-dnd\n    const draggableTransformY = parseInt(\n      draggableStyle.transform.split(',')[1].split('px')[0],\n      10\n    )\n\n    // And apply it to the card\n    transform = `translateY(${virtualItem.start + draggableTransformY}px)`\n  }\n\n  return {\n    position: 'absolute',\n    top: 0,\n    left: 0,\n    width: '100%',\n    height: `${virtualItem.size}px`,\n    transform,\n  }\n}\n\nexport default function DocumentList(props: DocumentListProps) {\n  const {\n    data = [],\n    invalidDocumentIds,\n    patchingIds,\n    selectedSchemaTypes,\n    selectedUserIds,\n    state,\n    states,\n    toggleInvalidDocumentId,\n    user,\n    userList,\n    userRoleCanDrop,\n  } = props\n\n  const dataFiltered = useMemo(() => {\n    return data.length\n      ? filterItemsAndSort(data, state.id, selectedUserIds, selectedSchemaTypes)\n      : []\n  }, [data, selectedSchemaTypes, selectedUserIds, state.id])\n\n  const parentRef = useRef(null)\n\n  const virtualizer = useVirtualizer({\n    count: dataFiltered.length,\n    getScrollElement: () => parentRef.current,\n    getItemKey: (index) => dataFiltered[index]?._metadata?.documentId ?? index,\n    estimateSize: () => 115,\n    overscan: 7,\n    measureElement: (element) => {\n      return element.getBoundingClientRect().height || 115\n    },\n  })\n\n  if (!data.length || !dataFiltered.length) {\n    return null\n  }\n\n  return (\n    <div\n      ref={parentRef}\n      style={{\n        height: `100%`,\n        overflow: 'auto',\n        // Smooths scrollbar behaviour\n        overflowAnchor: 'none',\n        scrollBehavior: 'auto',\n        paddingTop: 1,\n      }}\n    >\n      <div\n        style={{\n          height: `${virtualizer.getTotalSize()}px`,\n          width: '100%',\n          position: 'relative',\n        }}\n      >\n        {virtualizer.getVirtualItems().map((virtualItem) => {\n          const item = dataFiltered[virtualItem.index]\n\n          const {documentId, assignees} = item?._metadata ?? {}\n\n          const isInvalid = invalidDocumentIds.includes(documentId)\n          const meInAssignees = user?.id ? assignees?.includes(user.id) : false\n          const isDragDisabled =\n            patchingIds.includes(documentId) ||\n            !userRoleCanDrop ||\n            isInvalid ||\n            !(state.requireAssignment\n              ? state.requireAssignment && meInAssignees\n              : true)\n\n          return (\n            <Draggable\n              key={virtualItem.key}\n              draggableId={documentId}\n              index={virtualItem.index}\n              isDragDisabled={isDragDisabled}\n            >\n              {(draggableProvided, draggableSnapshot) => (\n                <div\n                  ref={draggableProvided.innerRef}\n                  {...draggableProvided.draggableProps}\n                  {...draggableProvided.dragHandleProps}\n                  style={getStyle(\n                    draggableProvided.draggableProps.style,\n                    virtualItem\n                  )}\n                >\n                  <div\n                    ref={virtualizer.measureElement}\n                    data-index={virtualItem.index}\n                  >\n                    <DocumentCard\n                      userRoleCanDrop={userRoleCanDrop}\n                      isDragDisabled={isDragDisabled}\n                      isPatching={patchingIds.includes(documentId)}\n                      isDragging={draggableSnapshot.isDragging}\n                      item={item}\n                      toggleInvalidDocumentId={toggleInvalidDocumentId}\n                      userList={userList}\n                      states={states}\n                    />\n                  </div>\n                </div>\n              )}\n            </Draggable>\n          )\n        })}\n      </div>\n    </div>\n  )\n}\n","import {\n  CheckmarkCircleIcon,\n  CircleIcon,\n  EarthAmericasIcon,\n  ResetIcon,\n  UserIcon,\n} from '@sanity/icons'\nimport {Button, Card, Flex, Menu, MenuButton, MenuItem} from '@sanity/ui'\nimport {useCallback, useMemo} from 'react'\nimport {useCurrentUser, UserAvatar, useSchema} from 'sanity'\nimport {UserExtended, UserSelectMenu} from 'sanity-plugin-utils'\n\nimport {FilterOptions} from '../types'\n\ntype FiltersProps = {\n  uniqueAssignedUsers: UserExtended[]\n  selectedLocales: FilterOptions['locales']\n  selectedUserIds: string[]\n  schemaTypes: string[]\n  selectedSchemaTypes: string[]\n  userLocales?: FilterOptions['locales']\n  toggleSelectedUser: (userId: string) => void\n  resetSelectedUsers: () => void\n  toggleSelectedSchemaType: (schemaType: string) => void\n  toggleLocales: (locales: FilterOptions['locales']) => void\n}\n\nexport default function Filters(props: FiltersProps) {\n  const {\n    uniqueAssignedUsers = [],\n    selectedLocales,\n    selectedUserIds,\n    schemaTypes,\n    selectedSchemaTypes,\n    toggleSelectedUser,\n    resetSelectedUsers,\n    toggleSelectedSchemaType,\n    toggleLocales,\n    userLocales,\n  } = props\n\n  const memoizedCurrentUser = useCurrentUser()\n\n  const currentUser = useMemo(() => memoizedCurrentUser, [memoizedCurrentUser])\n  const schema = useSchema()\n\n  const onAddUserToFilter = useCallback(\n    (id: string) => {\n      if (!selectedUserIds.includes(id)) {\n        toggleSelectedUser(id)\n      }\n    },\n    [selectedUserIds, toggleSelectedUser]\n  )\n\n  const onRemoveUserFromFilter = useCallback(\n    (id: string) => {\n      if (selectedUserIds.includes(id)) {\n        toggleSelectedUser(id)\n      }\n    },\n    [selectedUserIds, toggleSelectedUser]\n  )\n\n  const onClearUserFilter = useCallback(() => {\n    resetSelectedUsers()\n  }, [resetSelectedUsers])\n\n  const meInUniqueAssignees =\n    currentUser?.id && uniqueAssignedUsers.find((u) => u.id === currentUser.id)\n\n  const uniqueAssigneesNotMe = uniqueAssignedUsers.filter(\n    (u) => u.id !== currentUser?.id\n  )\n\n  const shouldDisplayUserFilter = uniqueAssignedUsers.length > 5\n\n  const localeFilterDisabled = userLocales && userLocales.length < 2\n\n  const sortedLocales = userLocales?.sort((a, b) => {\n    const aSelected = selectedLocales.includes(a) ? -1 : 1\n    const bSelected = selectedLocales.includes(b) ? -1 : 1\n    return aSelected - bSelected\n  })\n\n  const UserFilter = () => (\n    <Card tone=\"default\">\n      <MenuButton\n        button={\n          <Button\n            padding={3}\n            fontSize={1}\n            text=\"Filter Assignees\"\n            tone=\"primary\"\n            icon={UserIcon}\n          />\n        }\n        id=\"user-filters\"\n        popover={{portal: true, placement: 'top'}}\n        menu={\n          <Menu>\n            <UserSelectMenu\n              style={{maxHeight: '70dvh'}}\n              value={selectedUserIds}\n              userList={uniqueAssignedUsers}\n              onAdd={onAddUserToFilter}\n              onRemove={onRemoveUserFromFilter}\n              onClear={onClearUserFilter}\n              labels={{\n                addMe: 'Filter mine',\n                removeMe: 'Clear mine',\n                clear: 'Clear filters',\n              }}\n            />\n          </Menu>\n        }\n      />\n    </Card>\n  )\n\n  const SlimUserFilter = () => (\n    <Card tone=\"inherit\">\n      <Flex gap={2}>\n        {meInUniqueAssignees && (\n          <>\n            <Button\n              padding={0}\n              mode={\n                selectedUserIds.includes(currentUser.id) ? `default` : `bleed`\n              }\n              onClick={() => toggleSelectedUser(currentUser.id)}\n            >\n              <Flex padding={1} align=\"center\" justify=\"center\">\n                <UserAvatar user={currentUser.id} size={1} withTooltip />\n              </Flex>\n            </Button>\n            <Card borderRight style={{height: 30}} tone=\"inherit\" />\n          </>\n        )}\n\n        {uniqueAssigneesNotMe.map((user) => (\n          <Button\n            key={user.id}\n            padding={0}\n            mode={selectedUserIds.includes(user.id) ? 'default' : 'bleed'}\n            tone={selectedUserIds.includes(user.id) ? 'primary' : 'default'}\n            onClick={() => toggleSelectedUser(user.id)}\n          >\n            <Flex padding={1} align=\"center\" justify=\"center\">\n              <UserAvatar user={user} size={1} withTooltip />\n            </Flex>\n          </Button>\n        ))}\n\n        {selectedUserIds.length > 0 && (\n          <Button\n            padding={3}\n            fontSize={1}\n            text=\"Clear\"\n            onClick={resetSelectedUsers}\n            mode=\"ghost\"\n            tone=\"critical\"\n            icon={ResetIcon}\n          />\n        )}\n      </Flex>\n    </Card>\n  )\n\n  const LocaleFilter = () => (\n    <Card tone=\"default\">\n      <MenuButton\n        button={\n          <Button\n            padding={3}\n            fontSize={1}\n            text=\"Filter Languages\"\n            tone=\"primary\"\n            icon={EarthAmericasIcon}\n            disabled={localeFilterDisabled}\n          />\n        }\n        popover={{portal: true, placement: 'top', animate: true}}\n        id=\"locale-filters\"\n        menu={\n          <Menu style={{maxHeight: '70dvh'}}>\n            <MenuItem\n              fontSize={1}\n              onClick={() => toggleLocales(userLocales!)}\n              disabled={localeFilterDisabled}\n              tone=\"positive\"\n              padding={3}\n              text=\"Toggle all\"\n            />\n            {sortedLocales?.map((locale, idx) => {\n              const selected = selectedLocales.includes(locale)\n              return (\n                <MenuItem\n                  key={idx}\n                  text={new Intl.DisplayNames('en', {type: 'language'}).of(\n                    locale\n                  )}\n                  icon={\n                    selected ? (\n                      <CheckmarkCircleIcon\n                        style={{color: 'var(--card-badge-positive-icon-color)'}}\n                      />\n                    ) : (\n                      CircleIcon\n                    )\n                  }\n                  onClick={() => toggleLocales([locale])}\n                />\n              )\n            })}\n          </Menu>\n        }\n      />\n    </Card>\n  )\n\n  return (\n    <Card tone=\"primary\" padding={2} borderBottom style={{overflowX: 'hidden'}}>\n      <Flex align=\"center\">\n        <Flex align=\"center\" gap={4} flex={1}>\n          {shouldDisplayUserFilter && <UserFilter />}\n          {!shouldDisplayUserFilter && <SlimUserFilter />}\n          {userLocales && <LocaleFilter />}\n        </Flex>\n\n        {schemaTypes.length > 1 && (\n          <Flex align=\"center\" gap={1}>\n            {schemaTypes.map((typeName) => {\n              const schemaType = schema.get(typeName)\n\n              if (!schemaType) {\n                return null\n              }\n\n              return (\n                <Button\n                  padding={3}\n                  fontSize={1}\n                  key={typeName}\n                  text={schemaType?.title ?? typeName}\n                  icon={schemaType?.icon ?? undefined}\n                  mode={\n                    selectedSchemaTypes.includes(typeName) ? `default` : `ghost`\n                  }\n                  onClick={() => toggleSelectedSchemaType(typeName)}\n                />\n              )\n            })}\n          </Flex>\n        )}\n      </Flex>\n    </Card>\n  )\n}\n","import React from 'react'\nimport {Box, Text, Tooltip} from '@sanity/ui'\n\ntype StatusProps = {\n  text: string\n  icon: React.ComponentType\n}\n\nexport function Status(props: StatusProps) {\n  const {text, icon} = props\n  const Icon = icon\n\n  return (\n    <Tooltip\n      portal\n      content={\n        <Box padding={2}>\n          <Text size={1}>{text}</Text>\n        </Box>\n      }\n    >\n      <Text size={1}>\n        <Icon />\n      </Text>\n    </Tooltip>\n  )\n}\n","import {InfoOutlineIcon, UserIcon} from '@sanity/icons'\nimport {Badge, BadgeTone, Box, Card, Flex, Text} from '@sanity/ui'\nimport styled, {css} from 'styled-components'\n\nimport {State} from '../../types'\nimport {Status} from './Status'\n\nconst StyledStickyCard = styled(Card)(\n  () => css`\n    position: sticky;\n    top: 0;\n    z-index: 1;\n  `\n)\n\ntype StateTitleProps = {\n  state: State\n  requireAssignment: boolean\n  userRoleCanDrop: boolean\n  isDropDisabled: boolean\n  draggingFrom: string\n  documentCount: number\n}\n\nexport default function StateTitle(props: StateTitleProps) {\n  const {\n    state,\n    requireAssignment,\n    userRoleCanDrop,\n    isDropDisabled,\n    draggingFrom,\n    documentCount,\n  } = props\n\n  let tone: BadgeTone = 'default'\n  const isSource = draggingFrom === state.id\n\n  if (draggingFrom) {\n    tone = isDropDisabled || isSource ? 'default' : 'positive'\n  }\n\n  return (\n    <StyledStickyCard paddingY={4} padding={3} tone=\"inherit\">\n      <Flex gap={3} align=\"center\">\n        <Badge\n          mode={\n            (draggingFrom && !isDropDisabled) || isSource\n              ? 'default'\n              : 'outline'\n          }\n          tone={tone}\n          muted={!userRoleCanDrop || isDropDisabled}\n        >\n          {state.title}\n        </Badge>\n        {userRoleCanDrop ? null : (\n          <Status\n            text=\"You do not have permissions to move documents to this State\"\n            icon={InfoOutlineIcon}\n          />\n        )}\n        {requireAssignment ? (\n          <Status\n            text=\"You must be assigned to the document to move documents to this State\"\n            icon={UserIcon}\n          />\n        ) : null}\n        <Box flex={1}>\n          {documentCount > 0 ? (\n            <Text weight=\"semibold\" align=\"right\" size={1}>\n              {documentCount}\n            </Text>\n          ) : null}\n        </Box>\n      </Flex>\n    </StyledStickyCard>\n  )\n}\n","import {LexoRank} from 'lexorank'\n\nfunction generateMiddleValue(ranks: (LexoRank | undefined)[]) {\n  // Has no undefined values\n  if (!ranks.some((rank) => !rank)) {\n    return ranks\n  }\n\n  // Find the first undefined value\n  const firstUndefined = ranks.findIndex((rank) => !rank)\n\n  // Find the first defined value after the undefined value\n  const firstDefinedAfter = ranks.findIndex(\n    (rank, index) => rank && index > firstUndefined\n  )\n  // Find the first defined value before the undefined value\n  const firstDefinedBefore = ranks.findLastIndex(\n    (rank, index) => rank && index < firstUndefined\n  )\n\n  if (firstDefinedAfter === -1 || firstDefinedBefore === -1) {\n    throw new Error(\n      `Unable to generate middle value between indexes ${firstDefinedBefore} and ${firstDefinedAfter}`\n    )\n  }\n\n  const beforeRank = ranks[firstDefinedBefore]\n  const afterRank = ranks[firstDefinedAfter]\n\n  if (\n    !beforeRank ||\n    typeof beforeRank === 'undefined' ||\n    !afterRank ||\n    typeof afterRank === 'undefined'\n  ) {\n    throw new Error(\n      `Unable to generate middle value between indexes ${firstDefinedBefore} and ${firstDefinedAfter}`\n    )\n  }\n\n  // Generate a new value between the two\n  const between = beforeRank.between(afterRank)\n\n  // Calculate the middle index between the defined values\n  const middle = Math.floor((firstDefinedAfter + firstDefinedBefore) / 2)\n\n  if (ranks[middle]) {\n    throw new Error(`Should not have overwritten value at index ${middle}`)\n  }\n\n  // Insert the new value into the array\n  ranks[middle] = between\n\n  // Return as a new array\n  return ranks\n}\n\n// Generates an array of LexoRanks between two values\nexport function generateMultipleOrderRanks(\n  count: number,\n  start?: LexoRank,\n  end?: LexoRank\n): LexoRank[] {\n  // Begin array with correct size\n  let ranks = [...Array(count)]\n\n  // Use or create default values\n  const rankStart = start ?? LexoRank.min().genNext().genNext()\n  const rankEnd = end ?? LexoRank.max().genPrev().genPrev()\n\n  ranks[0] = rankStart\n  ranks[count - 1] = rankEnd\n\n  // Keep processing the array until every value between undefined values is defined\n  for (let i = 0; i < count; i++) {\n    ranks = generateMiddleValue(ranks)\n  }\n\n  return ranks.sort((a, b) => a.toString().localeCompare(b.toString()))\n}\n","import {PropsWithChildren} from 'react'\nimport styled, {css} from 'styled-components'\nimport {Card, Grid} from '@sanity/ui'\nimport {motion, AnimatePresence} from 'framer-motion'\n\nconst StyledFloatingCard = styled(Card)(\n  () => css`\n    position: fixed;\n    bottom: 0;\n    left: 0;\n    z-index: 1000;\n  `\n)\n\nexport default function FloatingCard({children}: PropsWithChildren) {\n  const childrenHaveValues = Array.isArray(children) ? children.some(Boolean) : Boolean(children)\n\n  return (\n    <AnimatePresence>\n      {childrenHaveValues ? (\n        <motion.div key=\"floater\" initial={{opacity: 0}} animate={{opacity: 1}} exit={{opacity: 0}}>\n          <StyledFloatingCard shadow={3} padding={3} margin={3} radius={3}>\n            <Grid gap={2}>{children}</Grid>\n          </StyledFloatingCard>\n        </motion.div>\n      ) : null}\n    </AnimatePresence>\n  )\n}\n","import {Button, useToast} from '@sanity/ui'\nimport {LexoRank} from 'lexorank'\nimport React from 'react'\nimport {useClient} from 'sanity'\nimport {UserExtended} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {generateMultipleOrderRanks} from '../helpers/generateMultipleOrderRanks'\nimport {SanityDocumentWithMetadata, State} from '../types'\nimport FloatingCard from './FloatingCard'\n\ntype VerifyProps = {\n  data: SanityDocumentWithMetadata[]\n  userList: UserExtended[]\n  states: State[]\n}\n\n// This component checks the validity of the data in the Kanban\n// It will only render something it there is invalid date\n// And will render buttons to fix the data\nexport default function Verify(props: VerifyProps) {\n  const {data, userList, states} = props\n  const client = useClient({apiVersion: API_VERSION})\n  const toast = useToast()\n\n  // A lot of error-checking\n  const documentsWithoutValidMetadataIds = data?.length\n    ? data.reduce((acc, cur) => {\n        const {documentId, state} = cur._metadata ?? {}\n        const stateExists = states.find((s) => s.id === state)\n\n        return !stateExists && documentId ? [...acc, documentId] : acc\n      }, [] as string[])\n    : []\n\n  const documentsWithInvalidUserIds =\n    data?.length && userList?.length\n      ? data.reduce((acc, cur) => {\n          const {documentId, assignees} = cur._metadata ?? {}\n          const allAssigneesExist = assignees?.length\n            ? assignees?.every((a) => userList.find((u) => u.id === a))\n            : true\n\n          return !allAssigneesExist && documentId ? [...acc, documentId] : acc\n        }, [] as string[])\n      : []\n\n  const documentsWithoutOrderIds = data?.length\n    ? data.reduce((acc, cur) => {\n        const {documentId, orderRank} = cur._metadata ?? {}\n\n        return !orderRank && documentId ? [...acc, documentId] : acc\n      }, [] as string[])\n    : []\n\n  const documentsWithDuplicatedOrderIds = data?.length\n    ? data.reduce((acc, cur) => {\n        const {documentId, orderRank} = cur._metadata ?? {}\n\n        return orderRank &&\n          data.filter((d) => d._metadata?.orderRank === orderRank).length > 1 &&\n          documentId\n          ? [...acc, documentId]\n          : acc\n      }, [] as string[])\n    : []\n\n  // Updates metadata documents to a valid, existing state\n  const correctDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Correcting...',\n        status: 'info',\n      })\n\n      const tx = ids.reduce((item, documentId) => {\n        return item.patch(`workflow-metadata.${documentId}`, {\n          set: {state: states[0].id},\n        })\n      }, client.transaction())\n\n      await tx.commit()\n\n      toast.push({\n        title: `Corrected ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [client, states, toast]\n  )\n\n  // Remove users that are no longer in the project from documents\n  const removeUsersFromDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Removing users...',\n        status: 'info',\n      })\n\n      const tx = ids.reduce((item, documentId) => {\n        const {assignees} =\n          data.find((d) => d._id === documentId)?._metadata ?? {}\n        const validAssignees = assignees?.length\n          ? // eslint-disable-next-line max-nested-callbacks\n            assignees.filter((a) => userList.find((u) => u.id === a)?.id)\n          : []\n\n        return item.patch(`workflow-metadata.${documentId}`, {\n          set: {assignees: validAssignees},\n        })\n      }, client.transaction())\n\n      await tx.commit()\n\n      toast.push({\n        title: `Corrected ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [client, data, toast, userList]\n  )\n\n  // Add order value to metadata documents\n  const addOrderToDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Adding ordering...',\n        status: 'info',\n      })\n\n      // Get first and second order values, if they exist\n      const [firstOrder, secondOrder] = [...data]\n        .slice(0, 2)\n        .map((d) => d._metadata?.orderRank)\n      const minLexo = firstOrder ? LexoRank.parse(firstOrder) : undefined\n      const maxLexo = secondOrder ? LexoRank.parse(secondOrder) : undefined\n      const ranks = generateMultipleOrderRanks(ids.length, minLexo, maxLexo)\n\n      const tx = client.transaction()\n\n      // Create a new in-between value for each document\n      for (let index = 0; index < ids.length; index += 1) {\n        tx.patch(`workflow-metadata.${ids[index]}`, {\n          set: {orderRank: ranks[index].toString()},\n        })\n      }\n\n      await tx.commit()\n\n      toast.push({\n        title: `Added order to ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [data, client, toast]\n  )\n\n  // Reset order value on all metadata documents\n  const resetOrderOfAllDocuments = React.useCallback(\n    async (ids: string[]) => {\n      toast.push({\n        title: 'Adding ordering...',\n        status: 'info',\n      })\n\n      const ranks = generateMultipleOrderRanks(ids.length)\n\n      const tx = client.transaction()\n\n      // Create a new in-between value for each document\n      for (let index = 0; index < ids.length; index += 1) {\n        tx.patch(`workflow-metadata.${ids[index]}`, {\n          set: {orderRank: ranks[index].toString()},\n        })\n      }\n\n      await tx.commit()\n\n      toast.push({\n        title: `Added order to ${\n          ids.length === 1 ? `1 Document` : `${ids.length} Documents`\n        }`,\n        status: 'success',\n      })\n    },\n    [data, client, toast]\n  )\n\n  // A document could be deleted and the workflow metadata left behind\n  const orphanedMetadataDocumentIds = React.useMemo(() => {\n    return data.length\n      ? data.filter((doc) => !doc?._id).map((doc) => doc._metadata.documentId)\n      : []\n  }, [data])\n\n  const handleOrphans = React.useCallback(() => {\n    toast.push({\n      title: 'Removing orphaned metadata...',\n      status: 'info',\n    })\n\n    const tx = client.transaction()\n    orphanedMetadataDocumentIds.forEach((id) => {\n      tx.delete(`workflow-metadata.${id}`)\n    })\n\n    tx.commit()\n\n    toast.push({\n      title: `Removed ${orphanedMetadataDocumentIds.length} orphaned metadata documents`,\n      status: 'success',\n    })\n  }, [client, orphanedMetadataDocumentIds, toast])\n\n  return (\n    <FloatingCard>\n      {documentsWithoutValidMetadataIds.length > 0 ? (\n        <Button\n          tone=\"caution\"\n          mode=\"ghost\"\n          onClick={() => correctDocuments(documentsWithoutValidMetadataIds)}\n          text={\n            documentsWithoutValidMetadataIds.length === 1\n              ? `Correct 1 Document State`\n              : `Correct ${documentsWithoutValidMetadataIds.length} Document States`\n          }\n        />\n      ) : null}\n      {documentsWithInvalidUserIds.length > 0 ? (\n        <Button\n          tone=\"caution\"\n          mode=\"ghost\"\n          onClick={() => removeUsersFromDocuments(documentsWithInvalidUserIds)}\n          text={\n            documentsWithInvalidUserIds.length === 1\n              ? `Remove Invalid Users from 1 Document`\n              : `Remove Invalid Users from ${documentsWithInvalidUserIds.length} Documents`\n          }\n        />\n      ) : null}\n      {documentsWithoutOrderIds.length > 0 ? (\n        <Button\n          tone=\"caution\"\n          mode=\"ghost\"\n          onClick={() => addOrderToDocuments(documentsWithoutOrderIds)}\n          text={\n            documentsWithoutOrderIds.length === 1\n              ? `Set Order for 1 Document`\n              : `Set Order for ${documentsWithoutOrderIds.length} Documents`\n          }\n        />\n      ) : null}\n      {documentsWithDuplicatedOrderIds.length > 0 ? (\n        <>\n          <Button\n            tone=\"caution\"\n            mode=\"ghost\"\n            onClick={() => addOrderToDocuments(documentsWithDuplicatedOrderIds)}\n            text={\n              documentsWithDuplicatedOrderIds.length === 1\n                ? `Set Unique Order for 1 Document`\n                : `Set Unique Order for ${documentsWithDuplicatedOrderIds.length} Documents`\n            }\n          />\n          <Button\n            tone=\"caution\"\n            mode=\"ghost\"\n            onClick={() =>\n              resetOrderOfAllDocuments(\n                data.map((doc) => String(doc._metadata?.documentId))\n              )\n            }\n            text={\n              data.length === 1\n                ? `Reset Order for 1 Document`\n                : `Reset Order for all ${data.length} Documents`\n            }\n          />\n        </>\n      ) : null}\n      {orphanedMetadataDocumentIds.length > 0 ? (\n        <Button\n          text=\"Cleanup orphaned metadata\"\n          onClick={handleOrphans}\n          tone=\"caution\"\n          mode=\"ghost\"\n        />\n      ) : null}\n    </FloatingCard>\n  )\n}\n","import {\n  DragDropContext,\n  DraggableChildrenFn,\n  DragStart,\n  Droppable,\n  DropResult,\n} from '@hello-pangea/dnd'\nimport {\n  Box,\n  Card,\n  Container,\n  Flex,\n  Grid,\n  Spinner,\n  Text,\n  useTheme,\n  useToast,\n} from '@sanity/ui'\nimport {LexoRank} from 'lexorank'\nimport {useCallback, useMemo, useState} from 'react'\nimport {Tool, useCurrentUser} from 'sanity'\nimport {Feedback} from 'sanity-plugin-utils'\n\nimport {API_VERSION} from '../constants'\nimport {arraysContainMatchingString} from '../helpers/arraysContainMatchingString'\nimport {filterItemsAndSort} from '../helpers/filterItemsAndSort'\nimport {useProjectUsers} from '../hooks/useUsers'\nimport {useWorkflowDocuments} from '../hooks/useWorkflowDocuments'\nimport {FilterOptions, State, WorkflowConfig} from '../types'\nimport {DocumentCard} from './DocumentCard'\nimport DocumentList from './DocumentList'\nimport Filters from './Filters'\nimport StateTitle from './StateTitle'\nimport Verify from './Verify'\n\ntype WorkflowToolProps = {\n  tool: Tool<WorkflowConfig>\n}\n\nexport default function WorkflowTool(props: WorkflowToolProps) {\n  const {\n    schemaTypes = [],\n    states = [],\n    filters = null,\n  } = props?.tool?.options ?? {}\n  const [patchingIds, setPatchingIds] = useState<string[]>([])\n  const [draggingFrom, setDraggingFrom] = useState('')\n  const [undroppableStates, setUndroppableStates] = useState<string[]>([])\n  const [selectedSchemaTypes, setSelectedSchemaTypes] =\n    useState<string[]>(schemaTypes)\n\n  const toast = useToast()\n  const theme = useTheme()\n  const isDarkMode = useMemo(() => theme.sanity.color.dark, [theme])\n  const defaultCardTone = isDarkMode ? 'default' : 'transparent'\n\n  const userList = useProjectUsers({apiVersion: API_VERSION})\n\n  const user = useCurrentUser()\n  const userRoleNames = useMemo(\n    () => (user?.roles?.length ? user.roles.map((r) => r.name) : []),\n    [user]\n  )\n\n  const filterOptions = useMemo(() => filters?.(user), [filters, user])\n  const userLocales = filterOptions?.locales\n\n  const LOCALE_FILTER_STORAGE_KEY = 'studio.plugin.workflow.locale-filter'\n\n  const [selectedLocales, setSelectedLocales] = useState<\n    FilterOptions['locales']\n  >(() => {\n    if (typeof window !== 'undefined') {\n      const storedLocales = localStorage.getItem(LOCALE_FILTER_STORAGE_KEY)\n      if (storedLocales) {\n        return JSON.parse(storedLocales)\n      }\n      return []\n    }\n    return filterOptions?.locales\n  })\n\n  const passedFilter = selectedLocales\n    ? ({locales: selectedLocales} as FilterOptions)\n    : undefined\n\n  const {workflowData, operations} = useWorkflowDocuments(\n    schemaTypes,\n    passedFilter\n  )\n\n  // Data to display in cards\n  const {data, loading, error} = workflowData\n\n  // Operations to perform on cards\n  const {move} = operations\n\n  // When drag starts, check for any States we should not allow dropping on\n  // Because of either:\n  // 1. The \"destination\" State requires user assignment and the user is not assigned to the dragged document\n  // 2. The \"source\" State State has a list of transitions and the \"destination\" State is not in that list\n  const handleDragStart = useCallback(\n    (start: DragStart) => {\n      const {draggableId, source} = start\n      const {droppableId: currentStateId} = source\n      setDraggingFrom(currentStateId)\n\n      const document = data.find(\n        (item) => item._metadata?.documentId === draggableId\n      )\n      const state = states.find((s) => s.id === currentStateId)\n\n      // This shouldn't happen but TypeScript\n      if (!document || !state) return\n\n      const undroppableStateIds = []\n      const statesThatRequireAssignmentIds = states\n        .filter((s) => s.requireAssignment)\n        .map((s) => s.id)\n\n      if (statesThatRequireAssignmentIds.length) {\n        const documentAssignees = document._metadata?.assignees ?? []\n        const userIsAssignedToDocument = user?.id\n          ? documentAssignees.includes(user.id)\n          : false\n\n        if (!userIsAssignedToDocument) {\n          undroppableStateIds.push(...statesThatRequireAssignmentIds)\n        }\n      }\n\n      const statesThatCannotBeTransitionedToIds =\n        state.transitions && state.transitions.length\n          ? states\n              .filter((s) => !state.transitions?.includes(s.id))\n              .map((s) => s.id)\n          : []\n\n      if (statesThatCannotBeTransitionedToIds.length) {\n        undroppableStateIds.push(...statesThatCannotBeTransitionedToIds)\n      }\n\n      // Remove currentStateId from undroppableStates\n      const undroppableExceptSelf = undroppableStateIds.filter(\n        (id) => id !== currentStateId\n      )\n\n      if (undroppableExceptSelf.length) {\n        setUndroppableStates(undroppableExceptSelf)\n      }\n    },\n    [data, states, user]\n  )\n\n  const handleDragEnd = useCallback(\n    async (result: DropResult) => {\n      // Reset undroppable states\n      setUndroppableStates([])\n      setDraggingFrom(``)\n\n      const {draggableId, source, destination} = result\n\n      if (\n        // No destination?\n        !destination ||\n        // No change in position?\n        (destination.droppableId === source.droppableId &&\n          destination.index === source.index)\n      ) {\n        return\n      }\n\n      // Find all items in current state\n      const destinationStateItems = [\n        ...filterItemsAndSort(data, destination.droppableId, [], null),\n      ]\n      const destinationStateIndex = states.findIndex(\n        (s) => s.id === destination.droppableId\n      )\n      const globalStateMinimumRank = data[0]._metadata.orderRank\n      const globalStateMaximumRank = data[data.length - 1]._metadata.orderRank\n\n      let newOrder\n\n      if (!destinationStateItems.length) {\n        // Only item in state\n        // New minimum rank\n        if (destinationStateIndex === 0) {\n          // Only the first state should generate an absolute minimum rank\n          newOrder = LexoRank.min().toString()\n        } else {\n          // Otherwise create one rank above the minimum\n          newOrder = LexoRank.min().genNext().toString()\n        }\n      } else if (destination.index === 0) {\n        // Now first item in order\n        const firstItemOrderRank = [...destinationStateItems].shift()?._metadata\n          ?.orderRank\n\n        if (firstItemOrderRank && typeof firstItemOrderRank === 'string') {\n          newOrder = LexoRank.parse(firstItemOrderRank).genPrev().toString()\n        } else if (destinationStateIndex === 0) {\n          // Only the first state should generate an absolute minimum rank\n          newOrder = LexoRank.min().toString()\n        } else {\n          // Otherwise create the next rank between min and the globally minimum rank\n          newOrder = LexoRank.parse(globalStateMinimumRank)\n            .between(LexoRank.min())\n            .toString()\n        }\n      } else if (destination.index + 1 === destinationStateItems.length) {\n        // Now last item in order\n        const lastItemOrderRank = [...destinationStateItems].pop()?._metadata\n          ?.orderRank\n\n        if (lastItemOrderRank && typeof lastItemOrderRank === 'string') {\n          newOrder = LexoRank.parse(lastItemOrderRank).genNext().toString()\n        } else if (destinationStateIndex === states.length - 1) {\n          // Only the last state should generate an absolute maximum rank\n          newOrder = LexoRank.max().toString()\n        } else {\n          // Otherwise create the next rank between max and the globally maximum rank\n          newOrder = LexoRank.parse(globalStateMaximumRank)\n            .between(LexoRank.min())\n            .toString()\n        }\n      } else {\n        // Must be between two items\n        const itemBefore = destinationStateItems[destination.index - 1]\n        const itemBeforeRank = itemBefore?._metadata?.orderRank\n        let itemBeforeRankParsed\n        if (itemBeforeRank) {\n          itemBeforeRankParsed = LexoRank.parse(itemBeforeRank)\n        } else if (destinationStateIndex === 0) {\n          itemBeforeRankParsed = LexoRank.min()\n        } else {\n          itemBeforeRankParsed = LexoRank.parse(globalStateMinimumRank)\n        }\n\n        const itemAfter = destinationStateItems[destination.index]\n        const itemAfterRank = itemAfter?._metadata?.orderRank\n        let itemAfterRankParsed\n        if (itemAfterRank) {\n          itemAfterRankParsed = LexoRank.parse(itemAfterRank)\n        } else if (destinationStateIndex === states.length - 1) {\n          itemAfterRankParsed = LexoRank.max()\n        } else {\n          itemAfterRankParsed = LexoRank.parse(globalStateMaximumRank)\n        }\n\n        newOrder = itemBeforeRankParsed.between(itemAfterRankParsed).toString()\n      }\n\n      setPatchingIds([...patchingIds, draggableId])\n      toast.push({\n        status: 'info',\n        title: 'Updating document state...',\n      })\n      await move(draggableId, destination, states, newOrder)\n      setPatchingIds((ids: string[]) => ids.filter((id) => id !== draggableId))\n    },\n    [data, patchingIds, toast, move, states]\n  )\n\n  const toggleLocales = useCallback((locales: string[]) => {\n    setSelectedLocales((prev) => {\n      const updatedLocales = Array.from(\n        locales.reduce((set, locale) => {\n          if (set.has(locale)) {\n            set.delete(locale)\n          } else {\n            set.add(locale)\n          }\n          return set\n        }, new Set(prev))\n      )\n\n      // Store in localStorage\n      localStorage.setItem(\n        LOCALE_FILTER_STORAGE_KEY,\n        JSON.stringify(updatedLocales)\n      )\n\n      return updatedLocales\n    })\n  }, [])\n\n  // Used for the user filter UI\n  const uniqueAssignedUsers = useMemo(() => {\n    const uniqueUserIds = data.reduce((acc, item) => {\n      const {assignees = []} = item._metadata ?? {}\n      const newAssignees = assignees?.length\n        ? assignees.filter((a) => !acc.includes(a))\n        : []\n      return newAssignees.length ? [...acc, ...newAssignees] : acc\n    }, [] as string[])\n\n    return userList.filter((u) => uniqueUserIds.includes(u.id))\n  }, [data, userList])\n\n  // Selected user IDs filter the visible workflow documents\n  const [selectedUserIds, setSelectedUserIds] = useState<string[]>(\n    uniqueAssignedUsers.map((u) => u.id)\n  )\n  const toggleSelectedUser = useCallback((userId: string) => {\n    setSelectedUserIds((prev) =>\n      prev.includes(userId)\n        ? prev.filter((u) => u !== userId)\n        : [...prev, userId]\n    )\n  }, [])\n\n  const resetSelectedUsers = useCallback(() => {\n    setSelectedUserIds([])\n  }, [])\n\n  // Selected schema types filter the visible workflow documents\n  const toggleSelectedSchemaType = useCallback((schemaType: string) => {\n    setSelectedSchemaTypes((prev) =>\n      prev.includes(schemaType)\n        ? prev.filter((u) => u !== schemaType)\n        : [...prev, schemaType]\n    )\n  }, [])\n\n  // Document IDs that have validation errors\n  const [invalidDocumentIds, setInvalidDocumentIds] = useState<string[]>([])\n  const toggleInvalidDocumentId = useCallback(\n    (docId: string, action: 'ADD' | 'REMOVE') => {\n      setInvalidDocumentIds((prev) =>\n        action === 'ADD' ? [...prev, docId] : prev.filter((id) => id !== docId)\n      )\n    },\n    []\n  )\n\n  const Clone: DraggableChildrenFn = useCallback(\n    (provided, snapshot, rubric) => {\n      const item = data.find(\n        (doc) => doc?._metadata?.documentId === rubric.draggableId\n      )\n\n      return (\n        <div\n          {...provided.draggableProps}\n          {...provided.dragHandleProps}\n          ref={provided.innerRef}\n        >\n          {item ? (\n            <DocumentCard\n              // Assumed false, if it's dragging it's not disabled\n              isDragDisabled={false}\n              // Assumed false, if it's dragging it's not patching\n              isPatching={false}\n              // Assumed true, if you can drag it you can drop it\n              userRoleCanDrop\n              isDragging={snapshot.isDragging}\n              item={item}\n              states={states}\n              toggleInvalidDocumentId={toggleInvalidDocumentId}\n              userList={userList}\n            />\n          ) : (\n            <Feedback title=\"Item not found\" tone=\"caution\" />\n          )}\n        </div>\n      )\n    },\n    [data, states, toggleInvalidDocumentId, userList]\n  )\n\n  if (!states?.length) {\n    return (\n      <Container width={1} padding={5}>\n        <Feedback\n          tone=\"caution\"\n          title=\"Plugin options error\"\n          description=\"No States defined in plugin config\"\n        />\n      </Container>\n    )\n  }\n\n  if (error && !data.length) {\n    return (\n      <Container width={1} padding={5}>\n        <Feedback\n          tone=\"critical\"\n          title=\"Error querying for Workflow documents\"\n        />\n      </Container>\n    )\n  }\n\n  return (\n    <Flex direction=\"column\" height=\"fill\" overflow=\"hidden\">\n      <Verify data={data} userList={userList} states={states} />\n      <Filters\n        uniqueAssignedUsers={uniqueAssignedUsers}\n        selectedUserIds={selectedUserIds}\n        toggleSelectedUser={toggleSelectedUser}\n        resetSelectedUsers={resetSelectedUsers}\n        schemaTypes={schemaTypes}\n        selectedSchemaTypes={selectedSchemaTypes}\n        toggleSelectedSchemaType={toggleSelectedSchemaType}\n        selectedLocales={selectedLocales}\n        toggleLocales={toggleLocales}\n        userLocales={userLocales}\n      />\n      <DragDropContext onDragStart={handleDragStart} onDragEnd={handleDragEnd}>\n        <Grid columns={states.length} height=\"fill\">\n          {states.map((state: State, stateIndex: number) => {\n            const userRoleCanDrop = state?.roles?.length\n              ? arraysContainMatchingString(state.roles, userRoleNames)\n              : true\n            const isDropDisabled =\n              !userRoleCanDrop || undroppableStates.includes(state.id)\n\n            const documentCount = filterItemsAndSort(\n              data,\n              state.id,\n              selectedUserIds,\n              selectedSchemaTypes\n            ).length\n\n            return (\n              <Card\n                key={state.id}\n                borderLeft={stateIndex > 0}\n                tone={defaultCardTone}\n              >\n                <Flex direction=\"column\" height=\"fill\">\n                  <StateTitle\n                    state={state}\n                    requireAssignment={state.requireAssignment ?? false}\n                    userRoleCanDrop={userRoleCanDrop}\n                    isDropDisabled={isDropDisabled}\n                    draggingFrom={draggingFrom}\n                    documentCount={\n                      selectedLocales.length > 0 ? documentCount : 0\n                    }\n                  />\n                  <Box flex={1}>\n                    <Droppable\n                      droppableId={state.id}\n                      isDropDisabled={isDropDisabled}\n                      // props required for virtualization\n                      mode=\"virtual\"\n                      renderClone={Clone}\n                    >\n                      {(provided, snapshot) => (\n                        <Card\n                          ref={provided.innerRef}\n                          tone={\n                            snapshot.isDraggingOver\n                              ? 'primary'\n                              : defaultCardTone\n                          }\n                          height=\"fill\"\n                        >\n                          {loading && (\n                            <Flex padding={5} align=\"center\" justify=\"center\">\n                              <Spinner muted />\n                            </Flex>\n                          )}\n                          {!loading && selectedLocales.length === 0 && (\n                            <Flex\n                              align=\"center\"\n                              justify=\"center\"\n                              height=\"fill\"\n                              padding={6}\n                            >\n                              <Text size={3} align=\"center\">\n                                No documents found.\n                                <br /> Have you selected a language in the\n                                filter?\n                              </Text>\n                            </Flex>\n                          )}\n                          {selectedLocales.length > 0 && (\n                            <DocumentList\n                              data={data}\n                              invalidDocumentIds={invalidDocumentIds}\n                              patchingIds={patchingIds}\n                              selectedSchemaTypes={selectedSchemaTypes}\n                              selectedUserIds={selectedUserIds}\n                              state={state}\n                              states={states}\n                              toggleInvalidDocumentId={toggleInvalidDocumentId}\n                              user={user}\n                              userList={userList}\n                              userRoleCanDrop={userRoleCanDrop}\n                            />\n                          )}\n                          {/* Not required for virtualized lists */}\n                          {/* {provided.placeholder} */}\n                        </Card>\n                      )}\n                    </Droppable>\n                  </Box>\n                </Flex>\n              </Card>\n            )\n          })}\n        </Grid>\n      </DragDropContext>\n    </Flex>\n  )\n}\n","import {SplitVerticalIcon} from '@sanity/icons'\nimport {Tool} from 'sanity'\n\nimport WorkflowTool from '../components/WorkflowTool'\nimport {WorkflowConfig} from '../types'\n\nexport type WorkflowToolConfig = (options: WorkflowConfig) => Tool\n\nexport const workflowTool: WorkflowToolConfig = (options: WorkflowConfig) => ({\n  name: 'workflow',\n  title: 'Workflow',\n  component: WorkflowTool,\n  icon: SplitVerticalIcon,\n  options,\n})\n","import {definePlugin, DocumentActionProps, isObjectInputProps} from 'sanity'\n\nimport {AssignWorkflow} from './actions/AssignWorkflow'\nimport {BeginWorkflow} from './actions/BeginWorkflow'\nimport {CompleteWorkflow} from './actions/CompleteWorkflow'\nimport {UpdateWorkflow} from './actions/UpdateWorkflow'\nimport {AssigneesBadge} from './badges/AssigneesBadge'\nimport {StateBadge} from './badges/StateBadge'\nimport {WorkflowProvider} from './components/WorkflowContext'\nimport WorkflowSignal from './components/WorkflowSignal'\nimport {DEFAULT_CONFIG} from './constants'\nimport metadata from './schema/workflow/workflow.metadata'\nimport {workflowTool} from './tools'\nimport {WorkflowConfig} from './types'\n\nexport const workflow = definePlugin<WorkflowConfig>(\n  (config = DEFAULT_CONFIG) => {\n    const {schemaTypes, states, filters} = {...DEFAULT_CONFIG, ...config}\n\n    if (!states?.length) {\n      throw new Error(`Workflow plugin: Missing \"states\" in config`)\n    }\n\n    if (!schemaTypes?.length) {\n      throw new Error(`Workflow plugin: Missing \"schemaTypes\" in config`)\n    }\n\n    return {\n      name: 'sanity-plugin-workflow',\n      schema: {\n        types: [metadata(states)],\n      },\n      // TODO: Remove 'workflow.metadata' from list of new document types\n      // ...\n      studio: {\n        components: {\n          layout: (props) =>\n            WorkflowProvider({\n              ...props,\n              workflow: {schemaTypes, states, filters},\n            }),\n        },\n      },\n      form: {\n        components: {\n          input: (props) => {\n            if (\n              props.id === `root` &&\n              isObjectInputProps(props) &&\n              schemaTypes.includes(props.schemaType.name)\n            ) {\n              return WorkflowSignal(props)\n            }\n\n            return props.renderDefault(props)\n          },\n        },\n      },\n      document: {\n        actions: (prev, context) => {\n          if (!schemaTypes.includes(context.schemaType)) {\n            return prev\n          }\n\n          return [\n            (props) => BeginWorkflow(props),\n            (props) => AssignWorkflow(props),\n            ...states.map(\n              (state) => (props: DocumentActionProps) =>\n                UpdateWorkflow(props, state)\n            ),\n            (props) => CompleteWorkflow(props),\n            ...prev,\n          ]\n        },\n        badges: (prev, context) => {\n          if (!schemaTypes.includes(context.schemaType)) {\n            return prev\n          }\n\n          const {documentId, currentUser} = context\n\n          if (!documentId) {\n            return prev\n          }\n\n          return [\n            () => StateBadge(documentId),\n            () => AssigneesBadge(documentId, currentUser),\n            ...prev,\n          ]\n        },\n      },\n      tools: [\n        // TODO: These configs could be read from Context\n        workflowTool({schemaTypes, states, filters}),\n      ],\n    }\n  }\n)\n"],"names":["defineStates","states","API_VERSION","DEFAULT_CONFIG","schemaTypes","id","title","color","roles","transitions","requireAssignment","filters","UserAssignment","props","assignees","userList","documentId","client","useClient","apiVersion","toast","useToast","addAssignee","React","useCallback","userId","user","find","u","push","status","patch","concat","setIfMissing","insert","commit","then","displayName","catch","err","console","error","description","removeAssignee","unset","clearAssignees","jsx","UserSelectMenu","style","maxHeight","value","onAdd","onClear","onRemove","useWorkflowMetadata","ids","data","rawData","loading","useListeningQuery","params","options","keyedMetadata","useMemo","length","reduce","acc","cur","WorkflowContext","createContext","addId","removeId","useWorkflowContext","current","useContext","metadata","WorkflowProvider","setIds","useState","includes","filter","i","Provider","workflow","children","renderDefault","chunkArray","array","size","chunks","slice","useProjectUsers","_ref","currentUser","useWorkspace","users","setUsers","useEffect","projectId","config","getUsersWithRoles","aclData","request","url","userIds","name","map","projectUserId","userIdChunks","usersData","chunk","chunkedUserIds","join","response","usersWithRoles","_a","userRoles","aclUser","isCurrentUser","AssignWorkflow","isDialogOpen","setDialogOpen","icon","UsersIcon","type","disabled","label","dialog","onClose","content","onHandle","BeginWorkflow","draft","beginning","setBeginning","complete","setComplete","handle","lowestOrderFirstState","fetch","state","createIfNotExists","_id","_type","orderRank","LexoRank","parse","genNext","toString","min","locale","SplitVerticalIcon","CompleteWorkflow","delete","s","isLastState","CheckmarkIcon","arraysContainMatchingString","one","two","some","item","UpdateWorkflow","actionState","_b","_c","_d","useCurrentUser","currentState","validation","isValidating","useValidationStatus","hasValidationErrors","requireValidation","v","level","newState","set","onComplete","currentStateIndex","findIndex","actionStateIndex","direction","DirectionIcon","ArrowRightIcon","ArrowLeftIcon","directionLabel","userRoleCanUpdateState","r","actionStateIsAValidTransition","userAssignmentCanUpdateState","AssigneesBadge","hasMe","assignee","assigneesCount","assigneeUsers","StateBadge","WorkflowSignal","replace","EditButton","navigateIntent","useRouter","Button","onClick","mode","fontSize","padding","tabIndex","EditIcon","text","Field","schema","useSchema","String","draftId","Spinner","schemaType","get","Feedback","tone","Card","border","jsxs","Flex","align","justify","gap","Preview","layout","UserAssignmentInput","useFormValue","stringValue","Array","isArray","initialRank","lastRankValue","lastRank","nextRank","defineType","liveEdit","fields","defineField","readOnly","list","components","input","initialValue","p","_ref2","getClient","lastDocOrderRank","order","of","filterItemsAndSort","items","stateId","selectedUsers","arguments","undefined","selectedSchemaTypes","_metadata","sort","a","b","aOrderRank","bOrderRank","localeCompare","useWorkflowDocuments","filterOptions","localeFilter","locales","QUERY","groq","__template","localDocuments","setLocalDocuments","move","draggedId","destination","newOrder","currentLocalData","newLocalDocuments","droppableId","optimistic","newStateId","document","d","_rev","ifRevisionId","res","message","workflowData","operations","AvatarGroup","max","len","me","visibleUsers","UserAvatar","Box","marginRight","paddingLeft","Text","UserDisplay","button","popover","setPopover","isOpen","setIsOpen","close","open","useClickOutside","Popover","ref","portal","AddIcon","Grid","moveDraftToPublished","publishedId","draftDoc","getDocument","createOrReplace","CompleteButton","handleComplete","event","currentTarget","Tooltip","TimeAgo","_ref3","time","timeAgo","useTimeAgo","DraftStatus","updatedAt","_updatedAt","Fragment","TextWithTone","dimmed","muted","PublishedStatus","PublishIcon","Validate","onChange","ValidationStatus","hasError","ErrorOutlineIcon","WarningOutlineIcon","DocumentCard","isDragDisabled","isPatching","userRoleCanDrop","isDragging","toggleInvalidDocumentId","isDarkMode","useTheme","sanity","dark","defaultCardTone","optimisticValidation","setOptimisticValidation","handleValidation","updates","cardTone","paddingBottom","paddingX","radius","shadow","Stack","borderBottom","paddingRight","pointerEvents","flex","skipVisibilityCheck","flexShrink","DragHandleIcon","paddingTop","getStyle","draggableStyle","virtualItem","transform","start","draggableTransformY","parseInt","split","position","top","left","width","height","DocumentList","invalidDocumentIds","patchingIds","selectedUserIds","dataFiltered","parentRef","useRef","virtualizer","useVirtualizer","count","getScrollElement","getItemKey","index","estimateSize","overscan","measureElement","element","getBoundingClientRect","overflow","overflowAnchor","scrollBehavior","getTotalSize","getVirtualItems","isInvalid","meInAssignees","Draggable","draggableId","draggableProvided","draggableSnapshot","innerRef","draggableProps","dragHandleProps","key","Filters","uniqueAssignedUsers","selectedLocales","toggleSelectedUser","resetSelectedUsers","toggleSelectedSchemaType","toggleLocales","userLocales","memoizedCurrentUser","onAddUserToFilter","onRemoveUserFromFilter","onClearUserFilter","meInUniqueAssignees","uniqueAssigneesNotMe","shouldDisplayUserFilter","localeFilterDisabled","sortedLocales","aSelected","bSelected","UserFilter","MenuButton","UserIcon","placement","menu","Menu","labels","addMe","removeMe","clear","SlimUserFilter","withTooltip","borderRight","ResetIcon","LocaleFilter","EarthAmericasIcon","animate","MenuItem","idx","selected","Intl","DisplayNames","CheckmarkCircleIcon","CircleIcon","overflowX","typeName","Status","Icon","StyledStickyCard","styled","css","StateTitle","isDropDisabled","draggingFrom","documentCount","isSource","paddingY","Badge","InfoOutlineIcon","weight","generateMiddleValue","ranks","rank","firstUndefined","firstDefinedAfter","firstDefinedBefore","findLastIndex","Error","beforeRank","afterRank","between","middle","Math","floor","generateMultipleOrderRanks","end","rankStart","rankEnd","genPrev","StyledFloatingCard","FloatingCard","_ref4","childrenHaveValues","Boolean","AnimatePresence","motion","div","initial","opacity","exit","margin","Verify","documentsWithoutValidMetadataIds","stateExists","documentsWithInvalidUserIds","allAssigneesExist","every","documentsWithoutOrderIds","documentsWithDuplicatedOrderIds","correctDocuments","tx","transaction","removeUsersFromDocuments","validAssignees","addOrderToDocuments","firstOrder","secondOrder","minLexo","maxLexo","resetOrderOfAllDocuments","orphanedMetadataDocumentIds","doc","handleOrphans","forEach","WorkflowTool","tool","setPatchingIds","setDraggingFrom","undroppableStates","setUndroppableStates","setSelectedSchemaTypes","theme","userRoleNames","LOCALE_FILTER_STORAGE_KEY","setSelectedLocales","window","storedLocales","localStorage","getItem","JSON","passedFilter","handleDragStart","source","currentStateId","undroppableStateIds","statesThatRequireAssignmentIds","documentAssignees","userIsAssignedToDocument","statesThatCannotBeTransitionedToIds","undroppableExceptSelf","handleDragEnd","result","_e","_f","destinationStateItems","destinationStateIndex","globalStateMinimumRank","globalStateMaximumRank","firstItemOrderRank","shift","lastItemOrderRank","pop","itemBefore","itemBeforeRank","itemBeforeRankParsed","itemAfter","itemAfterRank","itemAfterRankParsed","prev","updatedLocales","from","has","add","Set","setItem","stringify","uniqueUserIds","newAssignees","setSelectedUserIds","setInvalidDocumentIds","docId","action","Clone","provided","snapshot","rubric","Container","DragDropContext","onDragStart","onDragEnd","columns","stateIndex","borderLeft","Droppable","renderClone","isDraggingOver","workflowTool","component","definePlugin","types","studio","form","isObjectInputProps","actions","context","badges","tools"],"mappings":"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"}